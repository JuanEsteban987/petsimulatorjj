<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Programaci√≥n en el laberinto ¬∑ juego custom</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }
        body {
            background: linear-gradient(145deg, #1e2b3a 0%, #0f1a24 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .game-container {
            max-width: 650px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 3rem 3rem 2rem 2rem;
            padding: 2rem 1.5rem 2rem 1.5rem;
            box-shadow: 0 20px 30px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.1);
            border: 1px solid #4b6e8c;
        }
        h1 {
            text-align: center;
            margin: 0 0 0.5rem 0;
            font-weight: 600;
            font-size: 2.1rem;
            letter-spacing: 1px;
            color: #ffd966;
            text-shadow: 0 3px 0 #7a4d00, 0 5px 10px #00000080;
            word-break: break-word;
        }
        .sub {
            text-align: center;
            color: #b0d4f0;
            margin-top: -0.2rem;
            margin-bottom: 1.5rem;
            font-style: italic;
            font-weight: 300;
            border-bottom: 1px dashed #3e607b;
            padding-bottom: 0.5rem;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.7rem;
            aspect-ratio: 1 / 1;
            max-width: 350px;
            margin: 0 auto 1.5rem auto;
            background: #21384b;
            padding: 1rem;
            border-radius: 2.5rem;
            box-shadow: inset 0 -3px 0 #0d1b26, 0 15px 20px #00000060;
        }
        .cell {
            background: #2f4b65;
            border-radius: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: 600;
            aspect-ratio: 1 / 1;
            box-shadow: inset 0 -4px 0 #1b3140, 0 0 0 2px #2c4d66;
            color: #fff9e6;
            text-shadow: 0 2px 0 #00000070;
            transition: 0.1s ease;
        }
        .cell.player-cell {
            background: #f7c45a;
            box-shadow: inset 0 -4px 0 #b57c2a, 0 0 0 3px #ffecaa;
            color: #1e2b3a;
        }
        .wall {
            background: #3d2e24;
            box-shadow: inset 0 -4px 0 #241b15, 0 0 0 2px #684e3a;
            color: #ae8f76;
        }
        .info-panel {
            background: #14222e;
            border-radius: 3rem;
            padding: 1.5rem 1.2rem;
            box-shadow: inset 0 2px 6px #00000080, 0 8px 0 #0b151f;
            border: 1px solid #42749b;
        }
        .command-section-title {
            color: #c7e5ff;
            font-weight: 500;
            letter-spacing: 1px;
            margin: 0 0 0.8rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.3rem;
            border-left: 6px solid #ffb347;
            padding-left: 1rem;
        }
        .commands-list {
            background: #0f1c28;
            border-radius: 2.5rem;
            min-height: 4rem;
            padding: 0.8rem 1.2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.7rem;
            align-items: center;
            margin-bottom: 1.2rem;
            border: 1px solid #31658c;
            box-shadow: inset 0 2px 5px #000000;
        }
        .command-chip {
            background: #2f5575;
            border-radius: 3rem;
            padding: 0.4rem 0.9rem 0.4rem 1.3rem;
            display: inline-flex;
            align-items: center;
            gap: 0.7rem;
            font-size: 1.1rem;
            font-weight: 500;
            color: white;
            box-shadow: 0 3px 0 #173248, inset 0 0 0 1px #7fa9cc;
        }
        .command-chip button {
            background: #ac3e3e;
            border: none;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            line-height: 1;
            border-radius: 50%;
            width: 1.7rem;
            height: 1.7rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 0 #631d1d;
            transition: 0.1s ease;
            padding: 0;
        }
        .command-chip button:hover {
            background: #c55a5a;
            transform: scale(1.05);
        }
        .command-chip button:active {
            transform: translateY(2px);
            box-shadow: none;
        }
        .add-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.8rem;
            margin: 1.2rem 0 1rem 0;
        }
        .btn {
            background: #f0d9b0;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.8rem 1.5rem;
            border-radius: 3rem;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            box-shadow: 0 5px 0 #a07948, 0 8px 12px #00000040;
            cursor: pointer;
            transition: 0.08s linear;
            color: #1e2b3a;
            border: 1px solid #ffecb3;
        }
        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #a07948, 0 5px 10px #00000040;
        }
        .btn-primary {
            background: #ffb854;
            box-shadow: 0 5px 0 #b16f1d;
            color: #1e2b1e;
        }
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0 0.5rem;
        }
        .message {
            background: #07121c;
            border-radius: 4rem;
            padding: 0.9rem 1.8rem;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 500;
            color: #cce6ff;
            border: 1px solid #2b6599;
            margin-top: 1.5rem;
            box-shadow: inset 0 2px 5px black;
            min-height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .footer-dir {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0 0.2rem;
            color: #9bc2e6;
            font-size: 1.2rem;
        }
        .badge {
            background: #31658c;
            border-radius: 2rem;
            padding: 0.2rem 1.2rem;
            font-weight: 600;
            color: #ffdd9e;
        }
    </style>
</head>
<body>
<div class="game-container">
    <h1>‚öôÔ∏è LABERINTO CODE</h1>
    <div class="sub">construye tu programa ‚Üí alcanza la ‚òÖ</div>

    <!-- cuadr√≠cula 5x5 -->
    <div class="grid" id="gridContainer"></div>

    <!-- indicador de direcci√≥n actual (extra) -->
    <div class="footer-dir">
        <span>ü§ñ direcci√≥n:</span>
        <span class="badge" id="directionBadge">‚Üí</span>
    </div>

    <div class="info-panel">
        <div class="command-section-title">
            <span>üìú TUS INSTRUCCIONES</span>
            <span style="font-size:0.9rem; background:#0e2a3b; padding:0.2rem 1rem; border-radius:40px;" id="cmdCount">0</span>
        </div>

        <!-- lista de comandos agregados -->
        <div id="commandsList" class="commands-list">
            <!-- se llena din√°micamente -->
        </div>

        <!-- botones para agregar comandos -->
        <div class="add-buttons">
            <button class="btn" id="addForward">‚¨ÜÔ∏è ADELANTE</button>
            <button class="btn" id="addLeft">‚Ü™Ô∏è IZQUIERDA</button>
            <button class="btn" id="addRight">‚Ü©Ô∏è DERECHA</button>
        </div>

        <!-- acciones principales -->
        <div class="action-buttons">
            <button class="btn btn-primary" id="runBtn">‚ñ∂Ô∏è EJECUTAR</button>
            <button class="btn" id="resetGameBtn">üîÑ REINICIAR</button>
            <button class="btn" id="clearCommandsBtn">üóëÔ∏è BORRAR TODO</button>
        </div>
    </div>

    <!-- √°rea de mensajes (feedback) -->
    <div id="message" class="message">
        ‚ö° Coloca instrucciones y pulsa EJECUTAR
    </div>
</div>

<script>
    (function() {
        // ----- CONFIGURACI√ìN DEL JUEGO -----
        const SIZE = 5;  // grid 5x5
        // Muros fijos (paredes) para dar reto
        const WALLS = [
            { x: 2, y: 1 },
            { x: 2, y: 2 },
            { x: 3, y: 2 },
            // { x: 1, y: 3 }, // se puede descomentar para m√°s muros
        ];
        const GOAL = { x: 4, y: 4 };  // meta fija

        // Estado del jugador
        let player = { x: 0, y: 0 };
        let direction = 0;        // 0: derecha, 1: abajo, 2: izquierda, 3: arriba

        // Programa del jugador (lista de comandos)
        let commands = [];        // cada elemento: 'forward', 'left', 'right'

        // Elementos del DOM
        const gridEl = document.getElementById('gridContainer');
        const commandsListEl = document.getElementById('commandsList');
        const messageEl = document.getElementById('message');
        const directionBadge = document.getElementById('directionBadge');
        const cmdCountSpan = document.getElementById('cmdCount');

        // Mapeo de direcci√≥n a s√≠mbolo
        const DIR_SYMBOLS = ['‚Üí', '‚Üì', '‚Üê', '‚Üë'];

        // ----- FUNCIONES DE ACTUALIZACI√ìN DE INTERFAZ -----

        // Dibuja la cuadr√≠cula seg√∫n estado actual (jugador, meta, muros)
        function renderGrid() {
            gridEl.innerHTML = '';
            for (let row = 0; row < SIZE; row++) {
                for (let col = 0; col < SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';

                    // Comprobar si es muro
                    const isWall = WALLS.some(w => w.x === col && w.y === row);
                    if (isWall) {
                        cell.classList.add('wall');
                        cell.textContent = '‚ñà';
                    } else {
                        // Determinar si es la posici√≥n del jugador
                        if (player.x === col && player.y === row) {
                            cell.classList.add('player-cell');
                            cell.textContent = DIR_SYMBOLS[direction];  // mostramos direcci√≥n
                        }
                        // Si no es jugador, pero es la meta
                        else if (GOAL.x === col && GOAL.y === row) {
                            cell.textContent = '‚òÖ';
                            cell.style.color = '#ffd966';
                        } else {
                            // Celda vac√≠a
                            cell.textContent = '¬∑';
                            cell.style.color = '#5c7f9c';
                        }
                    }
                    gridEl.appendChild(cell);
                }
            }
            // Actualizar badge de direcci√≥n
            directionBadge.textContent = DIR_SYMBOLS[direction];
        }

        // Renderiza la lista de comandos (con botones de eliminar)
        function renderCommands() {
            commandsListEl.innerHTML = '';
            if (commands.length === 0) {
                commandsListEl.style.justifyContent = 'center';
                const emptyMsg = document.createElement('span');
                emptyMsg.textContent = '‚úñÔ∏è ninguna instrucci√≥n';
                emptyMsg.style.color = '#6f8fa8';
                emptyMsg.style.fontStyle = 'italic';
                commandsListEl.appendChild(emptyMsg);
            } else {
                commandsListEl.style.justifyContent = 'flex-start';
                commands.forEach((cmd, index) => {
                    const chip = document.createElement('span');
                    chip.className = 'command-chip';
                    let texto = '';
                    if (cmd === 'forward') texto = '‚¨ÜÔ∏è Adelante';
                    else if (cmd === 'left') texto = '‚Ü™Ô∏è Izquierda';
                    else if (cmd === 'right') texto = '‚Ü©Ô∏è Derecha';

                    chip.innerHTML = `${texto} <button class="remove-cmd" data-index="${index}">‚úï</button>`;
                    commandsListEl.appendChild(chip);
                });

                // Agregar eventos a los botones de eliminar (usamos delegaci√≥n m√°s simple)
                document.querySelectorAll('.remove-cmd').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const idx = btn.getAttribute('data-index');
                        if (idx !== null) removeCommand(parseInt(idx));
                    });
                });
            }
            // actualizar contador
            cmdCountSpan.textContent = commands.length;
        }

        // Mostrar mensaje al usuario
        function setMessage(text, esExito = false, esError = false) {
            messageEl.textContent = text;
            if (esExito) messageEl.style.background = '#1f5130';
            else if (esError) messageEl.style.background = '#631f1f';
            else messageEl.style.background = '#07121c';
        }

        // ----- L√ìGICA DE COMANDOS -----

        function addCommand(cmdType) {
            commands.push(cmdType);
            renderCommands();
            setMessage('‚ûï instrucci√≥n a√±adida', false, false);
        }

        function removeCommand(index) {
            if (index >= 0 && index < commands.length) {
                commands.splice(index, 1);
                renderCommands();
                setMessage('‚ùå instrucci√≥n eliminada', false, false);
            }
        }

        function clearCommands() {
            commands = [];
            renderCommands();
            setMessage('üì≠ programa borrado', false, false);
        }

        // Reiniciar jugador a posici√≥n inicial (0,0) y direcci√≥n derecha
        function resetGame() {
            player = { x: 0, y: 0 };
            direction = 0;  // derecha
            // No borramos comandos autom√°ticamente (depende del bot√≥n)
            renderGrid();
            setMessage('üîÑ Juego reiniciado. ¬°Puedes programar!', false, false);
        }

        // Funci√≥n que ejecuta el programa actual desde la posici√≥n actual
        function runProgram() {
            if (commands.length === 0) {
                setMessage('‚ö†Ô∏è Agrega algunas instrucciones primero', false, true);
                return;
            }

            // Copiar estado actual para simular
            let simX = player.x;
            let simY = player.y;
            let simDir = direction;

            // Definir movimientos seg√∫n direcci√≥n
            const dx = [1, 0, -1, 0];  // derecha, abajo, izquierda, arriba (columna x)
            const dy = [0, 1, 0, -1];  // fila y

            let mensaje = '';
            let exito = false;
            let choque = false;
            let metaAlcanzada = false;

            // Recorrer instrucciones
            for (let i = 0; i < commands.length; i++) {
                const cmd = commands[i];

                if (cmd === 'left') {
                    simDir = (simDir + 3) % 4;  // gira izquierda
                }
                else if (cmd === 'right') {
                    simDir = (simDir + 1) % 4;  // gira derecha
                }
                else if (cmd === 'forward') {
                    // calcular nueva posici√≥n
                    const newX = simX + dx[simDir];
                    const newY = simY + dy[simDir];

                    // verificar l√≠mites
                    if (newX < 0 || newX >= SIZE || newY < 0 || newY >= SIZE) {
                        mensaje = `üß± ¬°Instrucci√≥n ${i+1} se sale del tablero!`;
                        choque = true;
                        break;
                    }

                    // verificar muro
                    const chocaMuro = WALLS.some(w => w.x === newX && w.y === newY);
                    if (chocaMuro) {
                        mensaje = `üí• ¬°Instrucci√≥n ${i+1} choca contra un muro!`;
                        choque = true;
                        break;
                    }

                    // mover
                    simX = newX;
                    simY = newY;

                    // comprobar si lleg√≥ a la meta
                    if (simX === GOAL.x && simY === GOAL.y) {
                        metaAlcanzada = true;
                        mensaje = `üèÜ ¬°GENIAL! Has alcanzado la estrella ‚òÖ`;
                        exito = true;
                        break;  // termina programa porque gan√≥
                    }
                }
            }

            // Si no hubo choque ni meta, pero termina el ciclo
            if (!choque && !metaAlcanzada) {
                mensaje = `üìå Programa terminado. No llegaste a la meta.`;
            }

            // Actualizar estado real del jugador con el resultado de la simulaci√≥n
            // (si hubo choque, el jugador se queda en la √∫ltima posici√≥n v√°lida antes del choque)
            player.x = simX;
            player.y = simY;
            direction = simDir;

            // Reflejar cambios en la cuadr√≠cula
            renderGrid();

            // Mostrar mensaje apropiado
            if (exito) setMessage(mensaje, true, false);
            else if (choque) setMessage(mensaje, false, true);
            else setMessage(mensaje, false, false);

            // (Opcional) Si se gan√≥, podemos celebrar, pero no reseteamos autom√°ticamente.
        }

        // ----- INICIALIZACI√ìN Y EVENTOS -----

        function initGame() {
            // Asegurar que muros no est√©n sobre la meta o inicio
            // (por si acaso se modifica WALLS, comprobaci√≥n simple)
            if (WALLS.some(w => (w.x === GOAL.x && w.y === GOAL.y) || (w.x === 0 && w.y === 0))) {
                console.warn("Revisa WALLS: no debe cubrir inicio(0,0) ni meta(4,4)");
            }

            renderGrid();
            renderCommands();
            setMessage('‚ö° Crea tu algoritmo y ejecuta', false, false);
        }

        // Event listeners
        document.getElementById('addForward').addEventListener('click', () => addCommand('forward'));
        document.getElementById('addLeft').addEventListener('click', () => addCommand('left'));
        document.getElementById('addRight').addEventListener('click', () => addCommand('right'));

        document.getElementById('runBtn').addEventListener('click', runProgram);

        document.getElementById('resetGameBtn').addEventListener('click', () => {
            resetGame();
            // Por dise√±o, no borramos comandos al resetear. (opcional, as√≠ el programa se conserva)
            // Si se desea borrar tambi√©n comandos, descomentar:
            // clearCommands(); 
            // Pero lo dejamos sin borrar: el jugador puede reutilizar programa.
        });

        document.getElementById('clearCommandsBtn').addEventListener('click', () => {
            clearCommands();
        });

        // Llamar a la inicializaci√≥n
        initGame();

        // (opcional) Bot√≥n de reset tambi√©n podr√≠a borrar? prefiero que no, pero damos la opci√≥n.
        // A√±adimos un peque√±o extra: si se desea borrar y resetear a la vez, se usa reiniciar + borrar.
        // Perfecto.

        // Extra: mostrar goal y direcci√≥n cada vez
    })();
</script>
</body>
</html>

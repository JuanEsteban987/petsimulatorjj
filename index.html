<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2008 Shape Programmer PRO</title>
    <style>
        /* === ESTÃ‰TICA 2008 MEJORADA === */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #39658a;
            background: -moz-linear-gradient(top, #4b7ca1, #1a4b6d);
            background: -webkit-gradient(linear, left top, left bottom, from(#4b7ca1), to(#1a4b6d));
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Monaco', cursive, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            margin: 0;
            border: 3px solid #ffcc00;
            box-shadow: inset 0 0 30px #00000066;
        }

        .ventana-principal {
            width: 1200px;
            max-width: 100%;
            background: #ece9d8;
            border: 4px solid #2a6f9c;
            border-radius: 12px 12px 8px 8px;
            padding: 12px;
            -webkit-box-shadow: 8px 8px 16px #1e1e1e, inset 2px 2px 4px #ffffffb0;
            box-shadow: 8px 8px 16px #1e1e1e, inset 2px 2px 4px #ffffffb0;
        }

        .titulo-ventana {
            background: #2a6f9c;
            padding: 6px 10px;
            border-radius: 8px 8px 0 0;
            color: white;
            font-weight: bold;
            font-size: 20px;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 #0f2f44;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #ffd966;
        }

        .contenido-flex {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .panel-codigo {
            flex: 1.3;
            min-width: 320px;
            background: #d4d0c8;
            border: 3px inset #ffffffd0;
            border-right-color: #808080;
            border-bottom-color: #808080;
            padding: 15px;
            box-shadow: inset -2px -2px 8px #404040, inset 2px 2px 8px #f0f0f0;
        }

        .panel-codigo label {
            display: block;
            font-size: 18px;
            color: #1e3a5f;
            margin-bottom: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 0 #bbccdd;
        }

        textarea {
            width: 100%;
            height: 180px;
            background: #171717;
            border: 4px solid #7b7b7b;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            font-size: 15px;
            padding: 10px;
            resize: vertical;
            box-shadow: inset 0 0 12px #00aa00, 0 0 5px cyan;
            border-radius: 0;
            line-height: 1.5;
        }

        .botonera-principal {
            margin: 15px 0 10px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .boton-2008 {
            background: #b0d0f0;
            border: 3px outset #ffffff;
            border-right-color: #2a3f6e;
            border-bottom-color: #2a3f6e;
            color: #002856;
            font-family: 'Comic Sans MS', cursive;
            font-weight: bold;
            font-size: 18px;
            padding: 8px 18px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 2px 2px 0 #0a1c33;
            transition: 0.1s ease;
            border-radius: 0px;
        }

        .boton-2008:hover {
            background: #c5e1ff;
            border: 3px outset #fcfcfc;
            transform: scale(0.98);
        }

        .boton-2008:active {
            border: 3px inset #8ba0c0;
            background: #8faed0;
            box-shadow: inset 1px 1px 5px #131313;
        }

        .boton-pequeno {
            font-size: 14px;
            padding: 5px 10px;
            background: #e0e0c0;
            border: 2px outset #ffffe0;
            border-right-color: #6b6b4e;
            border-bottom-color: #6b6b4e;
        }

        .panel-autocompletar {
            background: #b9c9d6;
            border: 3px ridge #4f7b99;
            padding: 10px;
            margin: 12px 0 5px;
        }

        .panel-autocompletar .titulo {
            font-size: 16px;
            color: #0b2d44;
            margin-bottom: 8px;
            font-weight: bold;
            border-bottom: 2px solid #0f3857;
        }

        .comandos-rapidos {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .comando-boton {
            background: #eef4d0;
            border: 2px outset #faffc4;
            border-right-color: #8a9344;
            border-bottom-color: #8a9344;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 13px;
            padding: 4px 8px;
            cursor: pointer;
            color: #1d3d5c;
            box-shadow: 1px 1px 0 #1a2f40;
        }

        .comando-boton:hover {
            background: #f8ffb5;
        }

        .panel-canvas {
            flex: 2;
            min-width: 450px;
            background: #586e7e;
            border: 5px ridge #6f8fa2;
            padding: 10px;
            box-shadow: 0 0 0 2px #2c4b63, 10px 10px 20px #00000070;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            background: #2c3e4e;
            border: 3px solid #b9c9d6;
            box-shadow: inset 0 0 30px #000000, 4px 4px 8px black;
            cursor: crosshair;
            image-rendering: pixelated;
        }

        .barra-estado {
            margin-top: 15px;
            background: #b7c9d6;
            border: 2px inset #f0f0f0;
            border-top-color: #4a5c6b;
            border-left-color: #4a5c6b;
            padding: 6px 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #002240;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-text {
            text-shadow: 1px 1px 0 #cedae4;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .contador-shapes {
            background: #1d4357;
            color: #c0e0ff;
            padding: 2px 12px;
            border: 2px inset #58a3c7;
            border-radius: 20px;
            font-size: 15px;
        }

        .marquee-2008 {
            background: #f0dd96;
            border: 2px solid #aa7b3c;
            padding: 4px;
            font-size: 18px;
            color: #4d2800;
            margin: 8px 0 0;
            white-space: nowrap;
            overflow: hidden;
        }

        .marquee-2008 span {
            display: inline-block;
            width: 100%;
            animation: marquesina 12s linear infinite;
            font-weight: bold;
        }

        @keyframes marquesina {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        hr {
            border: 1px solid #406b8a;
            border-style: inset;
            margin: 12px 0 4px;
        }
    </style>
</head>
<body>
<div class="ventana-principal">
    <div class="titulo-ventana">
        <span>â—ˆ SHAPE PROGRAMMER 2008 â—ˆ</span>
        <span style="font-size:14px; margin-left:auto;">+ 9 nuevos comandos</span>
    </div>
    <div class="marquee-2008">
        <span>â˜… AUTCOMPLETAR CON BOTONES â˜… LIST / DELETE / CLEAN / COLOR / RENAME / MOVID / TPID â˜…</span>
    </div>

    <div class="contenido-flex">
        <!-- PANEL IZQUIERDO: CÃ“DIGO Y AUTOCOMPLETAR -->
        <div class="panel-codigo">
            <label>ðŸ“Ÿ TERMINAL DE COMANDOS (cada lÃ­nea uno):</label>
            <textarea id="codigoArea" placeholder="Ejemplo:
create:'cuadradoRojo,1':'Cubo':'red'
mov:'60':'20'
create:'circuloAzul,2':'CÃ­rculo':'#2266ff'
tp:'400':'200'">create:"MiForma,101":"Cubo":"#FF44AA"
mov:"30":"-10"
create:"Bola,202":"Circulo":"gold"
tp:"500":"150"</textarea>

            <div class="botonera-principal">
                <button class="boton-2008" id="runBtn">â–¶ EJECUTAR</button>
                <button class="boton-2008" id="resetBtn">â™» RESET SHAPES</button>
                <button class="boton-2008" id="limpiarCmdBtn">âŒ§ LIMPIAR CÃ“DIGO</button>
            </div>

            <!-- AUTOCOMPLETAR: BOTONES QUE INSERTAN PLANTILLAS -->
            <div class="panel-autocompletar">
                <div class="titulo">âš¡ AUTCOMPLETAR (haz clic para insertar comando):</div>
                <div class="comandos-rapidos">
                    <span class="comando-boton" data-cmd="create">create:"nombre,ID":"Cubo":"red"</span>
                    <span class="comando-boton" data-cmd="mov">mov:"X":"Y"</span>
                    <span class="comando-boton" data-cmd="tp">tp:"X":"Y"</span>
                    <span class="comando-boton" data-cmd="movid">movid:"ID":"X":"Y"</span>
                    <span class="comando-boton" data-cmd="tpid">tpid:"ID":"X":"Y"</span>
                    <span class="comando-boton" data-cmd="color">color:"ID":"blue"</span>
                    <span class="comando-boton" data-cmd="rename">rename:"ID":"nuevoNombre"</span>
                    <span class="comando-boton" data-cmd="delete">delete</span>
                    <span class="comando-boton" data-cmd="deleteid">delete:"ID"</span>
                    <span class="comando-boton" data-cmd="list">list</span>
                    <span class="comando-boton" data-cmd="clean">clean</span>
                </div>
                <div style="font-size:12px; margin-top:6px; color:#1d3a4f;"> click â†’ aÃ±ade lÃ­nea. Edita los valores.</div>
            </div>

            <hr>
            <div style="font-size:14px; color:#142f44; background:#fbe6b0; padding:8px; border:2px dashed #b0804c;">
                <strong>ðŸ“Œ COMANDOS 2008 (nuevos en negrita):</strong><br>
                create:"nombre,ID":"Cubo/Circulo/Triangulo":"color"<br>
                mov:"X":"Y" | tp:"X":"Y" <br>
                <strong>movid:"ID":"X":"Y" | tpid:"ID":"X":"Y"</strong><br>
                <strong>color:"ID":"nuevocolor" | rename:"ID":"nuevonombre"</strong><br>
                <strong>delete (Ãºltimo) | delete:"ID" | list | clean</strong><br>
                <span style="font-size:12px;">*Se aceptan comillas dobles, simples u omitidas si sin espacios.</span>
            </div>
        </div>

        <!-- PANEL DERECHO: CANVAS -->
        <div class="panel-canvas">
            <canvas id="lienzo" width="700" height="400"></canvas>
            <div class="barra-estado">
                <span class="status-text" id="estadoMsg">âœ” Listo. Crea figuras.</span>
                <span class="contador-shapes" id="contadorShapes">0 shapes</span>
            </div>
            <div style="margin-top: 6px; text-align:right; color:#e9f2fa; text-shadow:1px 1px 0 #0f1f2f;">
                canvas 700x400
            </div>
        </div>
    </div>

    <div style="display: flex; gap: 12px; margin-top: 12px; background:#cddae5; padding: 4px; border:1px solid #457d9c;">
        <span>â˜…</span><span> MSN 2008</span><span>â˜…</span><span style="margin-left:auto;">MySpace</span><span>â˜…</span><span>Fotolog</span><span>â˜…</span>
    </div>
</div>

<script>
    (function() {
        // --- CONFIGURACIÃ“N Y ESTADO ---
        const canvas = document.getElementById('lienzo');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('estadoMsg');
        const contadorEl = document.getElementById('contadorShapes');
        const codigoArea = document.getElementById('codigoArea');

        let shapes = [];
        let lastShapeIndex = -1;
        const DEFAULT_X = 350;
        const DEFAULT_Y = 200;

        // --- FUNCIONES DE DIBUJO (igual) ---
        function drawShape(shape) {
            const { type, color, x, y } = shape;
            ctx.fillStyle = color;
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 2;
            ctx.shadowColor = '#00000080';
            ctx.shadowBlur = 6;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;

            switch (type.toLowerCase()) {
                case 'cubo':
                case 'cube':
                case 'cuadrado':
                    ctx.fillRect(x - 25, y - 25, 50, 50);
                    ctx.strokeRect(x - 25, y - 25, 50, 50);
                    break;
                case 'circulo':
                case 'circle':
                case 'cÃ­rculo':
                    ctx.beginPath();
                    ctx.arc(x, y, 25, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'triangulo':
                case 'triangle':
                    ctx.beginPath();
                    ctx.moveTo(x, y - 30);
                    ctx.lineTo(x - 25, y + 15);
                    ctx.lineTo(x + 25, y + 15);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    break;
                default:
                    ctx.beginPath();
                    ctx.moveTo(x, y - 20);
                    ctx.lineTo(x + 20, y);
                    ctx.lineTo(x, y + 20);
                    ctx.lineTo(x - 20, y);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
            }
            ctx.shadowBlur = 0;
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#20394c';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#4c6c87';
            ctx.lineWidth = 0.5;
            for (let i = 0; i < canvas.width; i += 30) {
                ctx.beginPath();
                ctx.strokeStyle = '#2b4b5e';
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 30) {
                ctx.beginPath();
                ctx.strokeStyle = '#2b4b5e';
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            shapes.forEach(shape => drawShape(shape));
            contadorEl.innerText = shapes.length + (shapes.length === 1 ? ' shape' : ' shapes');
        }

        // --- PARSEADOR MEJORADO: acepta comillas dobles, simples o sin comillas si no hay espacios ---
        function parsearArgumentos(linea) {
            const partes = [];
            let buffer = '';
            let dentroComillas = false;
            let comillaUsada = '';
            for (let i = 0; i < linea.length; i++) {
                const c = linea[i];
                if ((c === '"' || c === "'") && (!dentroComillas || comillaUsada === c)) {
                    if (dentroComillas && comillaUsada === c) {
                        // cierre
                        dentroComillas = false;
                        comillaUsada = '';
                        partes.push(buffer);
                        buffer = '';
                    } else {
                        dentroComillas = true;
                        comillaUsada = c;
                    }
                    continue;
                }
                if (c === ':' && !dentroComillas) {
                    if (buffer.trim() !== '') {
                        partes.push(buffer.trim());
                    } else {
                        partes.push(''); // argumento vacÃ­o
                    }
                    buffer = '';
                    continue;
                }
                buffer += c;
            }
            if (buffer.trim() !== '' || dentroComillas) {
                partes.push(buffer.trim());
            }
            return partes;
        }

        // --- EJECUTAR UN COMANDO (devuelve true si ok) ---
        function ejecutarComando(linea, numeroLinea) {
            linea = linea.trim();
            if (linea === '' || linea.startsWith('//')) return true;

            // Extraer comando (primera palabra hasta ':')
            const idxColon = linea.indexOf(':');
            let comando, resto;
            if (idxColon === -1) {
                comando = linea.toLowerCase();
                resto = '';
            } else {
                comando = linea.substring(0, idxColon).toLowerCase().trim();
                resto = linea.substring(idxColon + 1);
            }

            // Parsear argumentos del resto
            let args = [];
            if (resto.trim() !== '') {
                args = parsearArgumentos(resto);
            }

            try {
                // --- CREATE ---
                if (comando === 'create') {
                    if (args.length < 3) {
                        statusEl.innerText = `Error create: necesita 3 argumentos`;
                        return false;
                    }
                    const nombreId = args[0];
                    let nombre = nombreId;
                    let id = '' + (shapes.length + 1);
                    if (nombreId.includes(',')) {
                        const split = nombreId.split(',').map(s => s.trim());
                        nombre = split[0] || 'sinNombre';
                        id = split[1] || id;
                    } else {
                        nombre = nombreId;
                    }

                    let formaRaw = args[1].toLowerCase();
                    let forma = 'Cubo';
                    if (formaRaw.includes('circulo') || formaRaw.includes('circle') || formaRaw.includes('cÃ­rculo')) forma = 'Circulo';
                    else if (formaRaw.includes('triangulo') || formaRaw.includes('triangle')) forma = 'Triangulo';
                    else forma = 'Cubo';

                    const color = args[2] || '#FFB6C1';

                    const newShape = {
                        id: id,
                        name: nombre,
                        type: forma,
                        color: color,
                        x: DEFAULT_X,
                        y: DEFAULT_Y
                    };
                    shapes.push(newShape);
                    lastShapeIndex = shapes.length - 1;
                    statusEl.innerText = `âœ” Creado: ${nombre} (ID ${id})`;
                }
                // --- MOV (Ãºltimo) ---
                else if (comando === 'mov') {
                    if (shapes.length === 0) { statusEl.innerText = `Error mov: no hay shapes`; return false; }
                    if (args.length < 2) { statusEl.innerText = `Error mov: necesito X e Y`; return false; }
                    const dx = parseFloat(args[0]);
                    const dy = parseFloat(args[1]);
                    if (isNaN(dx) || isNaN(dy)) { statusEl.innerText = `Error mov: X/Y deben ser nÃºmeros`; return false; }
                    const shape = shapes[lastShapeIndex];
                    shape.x += dx;
                    shape.y += dy;
                    statusEl.innerText = `âœ” Movido Ãºltimo (${shape.name}) a (${Math.round(shape.x)},${Math.round(shape.y)})`;
                }
                // --- TP (Ãºltimo) ---
                else if (comando === 'tp') {
                    if (shapes.length === 0) { statusEl.innerText = `Error tp: no hay shapes`; return false; }
                    if (args.length < 2) { statusEl.innerText = `Error tp: necesito X e Y`; return false; }
                    const newX = parseFloat(args[0]);
                    const newY = parseFloat(args[1]);
                    if (isNaN(newX) || isNaN(newY)) { statusEl.innerText = `Error tp: coordenadas invÃ¡lidas`; return false; }
                    const shape = shapes[lastShapeIndex];
                    shape.x = newX;
                    shape.y = newY;
                    statusEl.innerText = `âœ” Teletransportado Ãºltimo a (${newX},${newY})`;
                }
                // --- MOVID (mover por ID) ---
                else if (comando === 'movid') {
                    if (args.length < 3) { statusEl.innerText = `Error movid: necesito ID, X, Y`; return false; }
                    const idBuscado = args[0];
                    const dx = parseFloat(args[1]);
                    const dy = parseFloat(args[2]);
                    if (isNaN(dx) || isNaN(dy)) { statusEl.innerText = `Error movid: X/Y deben ser nÃºmeros`; return false; }
                    const index = shapes.findIndex(s => s.id == idBuscado);
                    if (index === -1) { statusEl.innerText = `Error movid: ID ${idBuscado} no encontrado`; return false; }
                    shapes[index].x += dx;
                    shapes[index].y += dy;
                    lastShapeIndex = index; // actualizar Ãºltimo
                    statusEl.innerText = `âœ” Movido ID ${idBuscado} a (${Math.round(shapes[index].x)},${Math.round(shapes[index].y)})`;
                }
                // --- TPID ---
                else if (comando === 'tpid') {
                    if (args.length < 3) { statusEl.innerText = `Error tpid: necesito ID, X, Y`; return false; }
                    const idBuscado = args[0];
                    const newX = parseFloat(args[1]);
                    const newY = parseFloat(args[2]);
                    if (isNaN(newX) || isNaN(newY)) { statusEl.innerText = `Error tpid: coordenadas invÃ¡lidas`; return false; }
                    const index = shapes.findIndex(s => s.id == idBuscado);
                    if (index === -1) { statusEl.innerText = `Error tpid: ID ${idBuscado} no encontrado`; return false; }
                    shapes[index].x = newX;
                    shapes[index].y = newY;
                    lastShapeIndex = index;
                    statusEl.innerText = `âœ” TP ID ${idBuscado} a (${newX},${newY})`;
                }
                // --- COLOR ---
                else if (comando === 'color') {
                    if (args.length < 2) { statusEl.innerText = `Error color: necesito ID y color`; return false; }
                    const idBuscado = args[0];
                    const nuevoColor = args[1];
                    const index = shapes.findIndex(s => s.id == idBuscado);
                    if (index === -1) { statusEl.innerText = `Error color: ID ${idBuscado} no encontrado`; return false; }
                    shapes[index].color = nuevoColor;
                    lastShapeIndex = index;
                    statusEl.innerText = `âœ” Color cambiado para ID ${idBuscado}`;
                }
                // --- RENAME ---
                else if (comando === 'rename') {
                    if (args.length < 2) { statusEl.innerText = `Error rename: necesito ID y nombre`; return false; }
                    const idBuscado = args[0];
                    const nuevoNombre = args[1];
                    const index = shapes.findIndex(s => s.id == idBuscado);
                    if (index === -1) { statusEl.innerText = `Error rename: ID ${idBuscado} no encontrado`; return false; }
                    shapes[index].name = nuevoNombre;
                    lastShapeIndex = index;
                    statusEl.innerText = `âœ” Renombrado ID ${idBuscado} a ${nuevoNombre}`;
                }
                // --- DELETE (sin argumento: Ãºltimo; con argumento: ID) ---
                else if (comando === 'delete') {
                    if (args.length === 0) {
                        if (shapes.length === 0) { statusEl.innerText = `Error delete: no hay shapes`; return false; }
                        const eliminado = shapes.splice(lastShapeIndex, 1)[0];
                        if (shapes.length === 0) lastShapeIndex = -1;
                        else lastShapeIndex = Math.min(lastShapeIndex, shapes.length - 1);
                        statusEl.innerText = `âœ” Eliminado Ãºltimo (${eliminado.name})`;
                    } else {
                        const idBuscado = args[0];
                        const index = shapes.findIndex(s => s.id == idBuscado);
                        if (index === -1) { statusEl.innerText = `Error delete: ID ${idBuscado} no encontrado`; return false; }
                        shapes.splice(index, 1);
                        if (shapes.length === 0) lastShapeIndex = -1;
                        else if (lastShapeIndex >= shapes.length) lastShapeIndex = shapes.length - 1;
                        statusEl.innerText = `âœ” Eliminado ID ${idBuscado}`;
                    }
                }
                // --- CLEAN (borrar todo) ---
                else if (comando === 'clean') {
                    shapes = [];
                    lastShapeIndex = -1;
                    statusEl.innerText = `âœ” Todas las shapes eliminadas (clean)`;
                }
                // --- LIST (mostrar en estado) ---
                else if (comando === 'list') {
                    if (shapes.length === 0) {
                        statusEl.innerText = `No hay shapes.`;
                    } else {
                        let lista = shapes.map(s => `${s.name}(ID:${s.id}, ${s.type}, ${s.color})`).join('; ');
                        statusEl.innerText = `Shapes: ${lista}`;
                    }
                }
                else {
                    statusEl.innerText = `Comando desconocido: ${comando}`;
                    return false;
                }
            } catch (e) {
                statusEl.innerText = `Error en lÃ­nea ${numeroLinea}: ${e.message}`;
                return false;
            }
            return true;
        }

        function ejecutarTodo() {
            const lineas = codigoArea.value.split('\n');
            let algunaOk = false;
            for (let i = 0; i < lineas.length; i++) {
                const ok = ejecutarComando(lineas[i], i + 1);
                if (ok) algunaOk = true;
            }
            redrawCanvas();
            if (!algunaOk && shapes.length === 0) {
                statusEl.innerText = 'âš  No se ejecutÃ³ ningÃºn comando vÃ¡lido';
            }
        }

        function resetShapes() {
            shapes = [];
            lastShapeIndex = -1;
            redrawCanvas();
            statusEl.innerText = 'â™» Shapes eliminadas. Crea nuevas.';
        }

        function limpiarComandos() {
            codigoArea.value = '';
            statusEl.innerText = 'âŒ¨ Escribe nuevos comandos';
        }

        // --- AUTOCOMPLETAR: insertar plantilla en textarea ---
        function insertarPlantilla(plantilla) {
            const posInicial = codigoArea.selectionStart;
            const texto = codigoArea.value;
            const nuevoTexto = texto.substring(0, posInicial) + plantilla + texto.substring(codigoArea.selectionEnd);
            codigoArea.value = nuevoTexto;
            codigoArea.focus();
            // Colocar cursor despuÃ©s de la plantilla
            const nuevaPos = posInicial + plantilla.length;
            codigoArea.setSelectionRange(nuevaPos, nuevaPos);
        }

        // Event listeners para botones de autocompletar
        document.querySelectorAll('.comando-boton').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const cmd = btn.getAttribute('data-cmd');
                let plantilla = '';
                switch (cmd) {
                    case 'create': plantilla = 'create:"nombre,ID":"Cubo":"red"'; break;
                    case 'mov': plantilla = 'mov:"X":"Y"'; break;
                    case 'tp': plantilla = 'tp:"X":"Y"'; break;
                    case 'movid': plantilla = 'movid:"ID":"X":"Y"'; break;
                    case 'tpid': plantilla = 'tpid:"ID":"X":"Y"'; break;
                    case 'color': plantilla = 'color:"ID":"blue"'; break;
                    case 'rename': plantilla = 'rename:"ID":"nuevoNombre"'; break;
                    case 'delete': plantilla = 'delete'; break;
                    case 'deleteid': plantilla = 'delete:"ID"'; break;
                    case 'list': plantilla = 'list'; break;
                    case 'clean': plantilla = 'clean'; break;
                    default: plantilla = btn.innerText;
                }
                insertarPlantilla(plantilla);
            });
        });

        // Eventos principales
        document.getElementById('runBtn').addEventListener('click', ejecutarTodo);
        document.getElementById('resetBtn').addEventListener('click', resetShapes);
        document.getElementById('limpiarCmdBtn').addEventListener('click', limpiarComandos);

        canvas.addEventListener('dblclick', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const mouseX = (e.clientX - rect.left) * scaleX;
            const mouseY = (e.clientY - rect.top) * scaleY;
            shapes.push({
                id: 'dblclick' + Math.floor(Math.random()*1000),
                name: 'dblclick',
                type: 'Circulo',
                color: '#AAAAAA',
                x: mouseX,
                y: mouseY
            });
            lastShapeIndex = shapes.length - 1;
            redrawCanvas();
            statusEl.innerText = `âž• CÃ­rculo gris en (${Math.round(mouseX)},${Math.round(mouseY)})`;
        });

        // Inicializar
        redrawCanvas();
        statusEl.innerText = 'Ready. Usa botones de autocompletar.';
    })();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scratch Blocks - Juego de Programaci√≥n</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background: #4a6b8f;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .game-container {
            width: 1300px;
            max-width: 100%;
            background: #f0f0f0;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        /* Cabecera */
        .header {
            background: #3a5e8c;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .header button {
            background: #ffcc00;
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }
        /* √Årea principal: canvas y bloques */
        .main-area {
            display: flex;
            padding: 20px;
            gap: 20px;
            background: #f0f0f0;
        }
        /* Panel izquierdo: canvas del juego */
        .canvas-panel {
            flex: 2;
            background: #d9e3f0;
            border-radius: 15px;
            padding: 15px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }
        canvas {
            width: 100%;
            height: 300px;
            background: #1e2a3a;
            border-radius: 10px;
            display: block;
            border: 3px solid #2c3e50;
        }
        .log {
            background: #1e2a3a;
            color: #0f0;
            padding: 8px;
            margin-top: 10px;
            border-radius: 5px;
            height: 80px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        /* Panel derecho: bloques */
        .blocks-panel {
            flex: 3;
            background: #e5e5e5;
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        /* Categor√≠as */
        .categories {
            display: flex;
            gap: 5px;
            background: #ccc;
            padding: 8px;
            border-radius: 10px;
            flex-wrap: wrap;
        }
        .cat-btn {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: transform 0.1s;
        }
        .cat-btn:hover { transform: scale(1.05); }
        .cat-btn.active { box-shadow: 0 0 0 3px black; }
        /* Paleta de bloques */
        .palette {
            background: #d5d5d5;
            border-radius: 10px;
            padding: 10px;
            height: 220px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
        }
        /* Bloques individuales (en paleta y en script) */
        .block {
            background: #4a90e2;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 0 #2a4b7a;
            cursor: grab;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            border: 1px solid rgba(255,255,255,0.3);
            transition: box-shadow 0.1s;
        }
        .block:active {
            cursor: grabbing;
            box-shadow: 0 2px 0 #2a4b7a;
            transform: translateY(2px);
        }
        .block.motion { background: #4a90e2; }
        .block.looks { background: #9b59b6; }
        .block.sound { background: #e67e22; }
        .block.event { background: #f1c40f; color: black; }
        .block.control { background: #e74c3c; }
        .block.sensing { background: #3498db; }
        .block.operators { background: #2ecc71; }
        .block.variables { background: #e67e22; }
        /* √Årea de script (bloques encajados) */
        .script-area {
            background: #b5b5b5;
            border-radius: 10px;
            padding: 15px;
            min-height: 250px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 5px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .script-block {
            background: #4a90e2;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 0 #2a4b7a;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            margin-bottom: 2px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .script-block .delete {
            background: #c0392b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            margin-left: auto;
        }
        .script-block input {
            width: 50px;
            background: white;
            border: none;
            border-radius: 5px;
            padding: 2px 5px;
            color: black;
        }
        .script-block select {
            background: white;
            border: none;
            border-radius: 5px;
            padding: 2px 5px;
        }
        .bottom-buttons {
            display: flex;
            gap: 10px;
            padding: 10px;
        }
        .bottom-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            background: #2c3e50;
            color: white;
            cursor: pointer;
        }
        .bottom-buttons .run {
            background: #27ae60;
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="header">
        <h1>üê± Scratch Blocks - Juego de Programaci√≥n</h1>
        <button id="runBtn">‚ñ∂ EJECUTAR</button>
    </div>
    <div class="main-area">
        <!-- Panel izquierdo: canvas y log -->
        <div class="canvas-panel">
            <canvas id="gameCanvas" width="500" height="300"></canvas>
            <div class="log" id="log">> Listo</div>
        </div>
        <!-- Panel derecho: bloques -->
        <div class="blocks-panel">
            <!-- Categor√≠as -->
            <div class="categories" id="categories">
                <button class="cat-btn" style="background:#4a90e2;" onclick="showCategory('motion')">Movimiento</button>
                <button class="cat-btn" style="background:#9b59b6;" onclick="showCategory('looks')">Apariencia</button>
                <button class="cat-btn" style="background:#e67e22;" onclick="showCategory('sound')">Sonido</button>
                <button class="cat-btn" style="background:#f1c40f; color:black;" onclick="showCategory('event')">Eventos</button>
                <button class="cat-btn" style="background:#e74c3c;" onclick="showCategory('control')">Control</button>
                <button class="cat-btn" style="background:#3498db;" onclick="showCategory('sensing')">Sensores</button>
                <button class="cat-btn" style="background:#2ecc71;" onclick="showCategory('operators')">Operadores</button>
                <button class="cat-btn" style="background:#e67e22;" onclick="showCategory('variables')">Variables</button>
            </div>
            <!-- Paleta de bloques (se llena con JS) -->
            <div class="palette" id="palette"></div>
            <!-- √Årea de script (bloques encajados) -->
            <div class="script-area" id="scriptArea"></div>
            <!-- Botones inferiores -->
            <div class="bottom-buttons">
                <button id="resetBtn">‚Ü∫ Reiniciar</button>
                <button id="clearBtn">üóëÔ∏è Limpiar</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // CONFIGURACI√ìN DE BLOQUES (m√°s de 50)
    // ============================================================
    const blocksData = {
        motion: [
            { name: 'mover_x', text: 'mover en X', params: ['objeto', 'pasos'], default: ['gato', 10], color: 'motion' },
            { name: 'mover_y', text: 'mover en Y', params: ['objeto', 'pasos'], default: ['gato', 10], color: 'motion' },
            { name: 'ir_a', text: 'ir a posici√≥n', params: ['objeto', 'x', 'y'], default: ['gato', 100, 100], color: 'motion' },
            { name: 'movimiento_aleatorio', text: 'ir a posici√≥n aleatoria', params: ['objeto'], default: ['gato'], color: 'motion' },
            { name: 'deslizar', text: 'deslizar en X', params: ['objeto', 'seg', 'pasos'], default: ['gato', 1, 50], color: 'motion' },
            { name: 'rebotar', text: 'rebotar si toca borde', params: ['objeto'], default: ['gato'], color: 'motion' },
            { name: 'girar', text: 'girar grados', params: ['objeto', 'grados'], default: ['gato', 15], color: 'motion' },
            { name: 'apuntar', text: 'apuntar hacia', params: ['objeto', 'direccion'], default: ['gato', 'enemigo'], color: 'motion' }
        ],
        looks: [
            { name: 'decir', text: 'decir', params: ['mensaje'], default: ['Hola!'], color: 'looks' },
            { name: 'pensar', text: 'pensar', params: ['mensaje'], default: ['...'], color: 'looks' },
            { name: 'cambiar_color', text: 'cambiar color', params: ['objeto', 'color'], default: ['gato', 'rojo'], color: 'looks' },
            { name: 'color_aleatorio', text: 'color aleatorio', params: ['objeto'], default: ['gato'], color: 'looks' },
            { name: 'cambiar_tama√±o', text: 'cambiar tama√±o', params: ['objeto', 'porcentaje'], default: ['gato', 10], color: 'looks' },
            { name: 'fijar_tama√±o', text: 'fijar tama√±o %', params: ['objeto', 'porcentaje'], default: ['gato', 100], color: 'looks' },
            { name: 'mostrar', text: 'mostrar', params: ['objeto'], default: ['gato'], color: 'looks' },
            { name: 'ocultar', text: 'ocultar', params: ['objeto'], default: ['gato'], color: 'looks' }
        ],
        sound: [
            { name: 'reproducir_sonido', text: 'reproducir sonido', params: ['sonido'], default: ['maullido'], color: 'sound' },
            { name: 'tocar_tambor', text: 'tocar tambor', params: ['ritmo'], default: ['1'], color: 'sound' },
            { name: 'subir_volumen', text: 'subir volumen', params: ['valor'], default: [10], color: 'sound' },
            { name: 'bajar_volumen', text: 'bajar volumen', params: ['valor'], default: [10], color: 'sound' },
            { name: 'silenciar', text: 'silenciar', params: [], default: [], color: 'sound' }
        ],
        event: [
            { name: 'al_presionar_tecla', text: 'al presionar tecla', params: ['tecla'], default: ['espacio'], color: 'event' },
            { name: 'al_hacer_click', text: 'al hacer click en objeto', params: ['objeto'], default: ['gato'], color: 'event' },
            { name: 'al_iniciar', text: 'al iniciar', params: [], default: [], color: 'event' },
            { name: 'enviar_mensaje', text: 'enviar mensaje', params: ['mensaje'], default: ['evento1'], color: 'event' },
            { name: 'cuando_reciba', text: 'cuando reciba mensaje', params: ['mensaje'], default: ['evento1'], color: 'event' }
        ],
        control: [
            { name: 'esperar', text: 'esperar segundos', params: ['seg'], default: [1], color: 'control' },
            { name: 'repetir', text: 'repetir veces', params: ['veces', 'bloque'], default: [10, 'movimiento'], color: 'control' },
            { name: 'por_siempre', text: 'por siempre', params: [], default: [], color: 'control' },
            { name: 'si_entonces', text: 'si ... entonces', params: ['condicion', 'bloque'], default: ['true', 'movimiento'], color: 'control' },
            { name: 'si_sino', text: 'si ... sino', params: ['condicion', 'bloque1', 'bloque2'], default: ['true', 'movimiento', 'esperar'], color: 'control' },
            { name: 'detener_programa', text: 'detener programa', params: [], default: [], color: 'control' }
        ],
        sensing: [
            { name: 'tocando_objeto', text: '¬øtocando objeto?', params: ['objeto1', 'objeto2'], default: ['gato', 'enemigo'], color: 'sensing' },
            { name: 'distancia_a', text: 'distancia a', params: ['objeto1', 'objeto2'], default: ['gato', 'enemigo'], color: 'sensing' },
            { name: 'preguntar', text: 'preguntar y esperar', params: ['pregunta'], default: ['¬øC√≥mo te llamas?'], color: 'sensing' },
            { name: 'respuesta', text: 'respuesta', params: [], default: [], color: 'sensing' },
            { name: 'posicion_x', text: 'posici√≥n X de', params: ['objeto'], default: ['gato'], color: 'sensing' },
            { name: 'posicion_y', text: 'posici√≥n Y de', params: ['objeto'], default: ['gato'], color: 'sensing' }
        ],
        operators: [
            { name: 'suma', text: 'suma', params: ['a', 'b'], default: [1, 2], color: 'operators' },
            { name: 'resta', text: 'resta', params: ['a', 'b'], default: [5, 3], color: 'operators' },
            { name: 'multiplica', text: 'multiplica', params: ['a', 'b'], default: [2, 3], color: 'operators' },
            { name: 'divide', text: 'divide', params: ['a', 'b'], default: [10, 2], color: 'operators' },
            { name: 'aleatorio', text: 'n√∫mero aleatorio', params: ['min', 'max'], default: [1, 10], color: 'operators' },
            { name: 'mayor_que', text: 'mayor que', params: ['a', 'b'], default: [5, 3], color: 'operators' },
            { name: 'menor_que', text: 'menor que', params: ['a', 'b'], default: [3, 5], color: 'operators' },
            { name: 'igual', text: 'igual', params: ['a', 'b'], default: [5, 5], color: 'operators' },
            { name: 'y', text: 'y', params: ['cond1', 'cond2'], default: [true, false], color: 'operators' },
            { name: 'o', text: 'o', params: ['cond1', 'cond2'], default: [true, false], color: 'operators' },
            { name: 'no', text: 'no', params: ['cond'], default: [false], color: 'operators' }
        ],
        variables: [
            { name: 'crear_variable', text: 'crear variable', params: ['nombre', 'valor'], default: ['puntaje', 0], color: 'variables' },
            { name: 'cambiar_variable', text: 'cambiar variable', params: ['nombre', 'valor'], default: ['puntaje', 1], color: 'variables' },
            { name: 'fijar_variable', text: 'fijar variable', params: ['nombre', 'valor'], default: ['puntaje', 10], color: 'variables' },
            { name: 'mostrar_variable', text: 'mostrar variable', params: ['nombre'], default: ['puntaje'], color: 'variables' },
            { name: 'ocultar_variable', text: 'ocultar variable', params: ['nombre'], default: ['puntaje'], color: 'variables' },
            { name: 'incrementar', text: 'incrementar', params: ['nombre'], default: ['puntaje'], color: 'variables' },
            { name: 'decrementar', text: 'decrementar', params: ['nombre'], default: ['puntaje'], color: 'variables' }
        ]
    };

    // ============================================================
    // ESTADO DEL JUEGO
    // ============================================================
    let gameObjects = {
        gato: { name: 'gato', x: 100, y: 150, color: '#f1c40f', visible: true, tama√±o: 100 },
        enemigo: { name: 'enemigo', x: 300, y: 150, color: '#e74c3c', visible: true, tama√±o: 100 }
    };
    let variables = { puntaje: 0 };
    let scriptBlocks = []; // bloques en el √°rea de script

    // ============================================================
    // FUNCIONES DE INTERFAZ
    // ============================================================
    let currentCategory = 'motion';

    function showCategory(cat) {
        currentCategory = cat;
        document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        renderPalette();
    }

    function renderPalette() {
        const palette = document.getElementById('palette');
        const blocks = blocksData[currentCategory] || [];
        palette.innerHTML = '';
        blocks.forEach(block => {
            const div = document.createElement('div');
            div.className = `block ${block.color}`;
            div.setAttribute('draggable', 'true');
            div.textContent = block.text;
            div.dataset.name = block.name;
            div.dataset.params = JSON.stringify(block.params);
            div.dataset.default = JSON.stringify(block.default);
            div.addEventListener('dragstart', handleDragStart);
            palette.appendChild(div);
        });
    }

    // Arrastrar bloques desde la paleta
    function handleDragStart(e) {
        e.dataTransfer.setData('text/plain', JSON.stringify({
            name: e.target.dataset.name,
            params: JSON.parse(e.target.dataset.params),
            default: JSON.parse(e.target.dataset.default)
        }));
        e.dataTransfer.effectAllowed = 'copy';
    }

    // √Årea de script: permitir soltar
    const scriptArea = document.getElementById('scriptArea');
    scriptArea.addEventListener('dragover', e => e.preventDefault());
    scriptArea.addEventListener('drop', e => {
        e.preventDefault();
        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        addBlockToScript(data);
    });

    function addBlockToScript(blockData) {
        const newBlock = {
            name: blockData.name,
            params: blockData.default.slice(),
            paramNames: blockData.params
        };
        scriptBlocks.push(newBlock);
        renderScript();
    }

    function renderScript() {
        scriptArea.innerHTML = '';
        scriptBlocks.forEach((block, index) => {
            const blockDiv = document.createElement('div');
            blockDiv.className = 'script-block';
            // Buscar el color del bloque en blocksData
            let colorClass = 'motion';
            for (let cat in blocksData) {
                const found = blocksData[cat].find(b => b.name === block.name);
                if (found) { colorClass = found.color; break; }
            }
            blockDiv.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(`--${colorClass}`) || '#4a90e2';

            // Texto del bloque
            const textSpan = document.createElement('span');
            textSpan.textContent = block.name.replace(/_/g,' ') + ' ';
            blockDiv.appendChild(textSpan);

            // Par√°metros editables
            block.paramNames.forEach((paramName, i) => {
                if (paramName === 'objeto') {
                    const select = document.createElement('select');
                    select.innerHTML = `<option>gato</option><option>enemigo</option>`;
                    select.value = block.params[i];
                    select.onchange = (e) => { block.params[i] = e.target.value; };
                    blockDiv.appendChild(select);
                } else if (paramName === 'color') {
                    const select = document.createElement('select');
                    select.innerHTML = `<option>rojo</option><option>azul</option><option>verde</option><option>amarillo</option>`;
                    select.value = block.params[i];
                    select.onchange = (e) => { block.params[i] = e.target.value; };
                    blockDiv.appendChild(select);
                } else {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = block.params[i];
                    input.onchange = (e) => { block.params[i] = e.target.value; };
                    blockDiv.appendChild(input);
                }
                if (i < block.paramNames.length - 1) blockDiv.appendChild(document.createTextNode(' '));
            });

            // Bot√≥n eliminar
            const del = document.createElement('span');
            del.className = 'delete';
            del.textContent = '‚úñ';
            del.onclick = () => { scriptBlocks.splice(index, 1); renderScript(); };
            blockDiv.appendChild(del);

            scriptArea.appendChild(blockDiv);
        });
    }

    // ============================================================
    // EJECUCI√ìN DE BLOQUES (simulada)
    // ============================================================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const logDiv = document.getElementById('log');

    function addLog(msg) {
        logDiv.innerHTML += '<br>> ' + msg;
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    function drawGame() {
        ctx.fillStyle = '#1e2a3a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (let name in gameObjects) {
            let obj = gameObjects[name];
            if (!obj.visible) continue;
            ctx.save();
            ctx.translate(obj.x, obj.y);
            ctx.fillStyle = obj.color;
            ctx.beginPath();
            ctx.arc(0, 0, 15 * (obj.tama√±o/100), 0, 2*Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.restore();
            ctx.fillStyle = '#fff';
            ctx.font = '12px monospace';
            ctx.fillText(name, obj.x-20, obj.y-20);
        }
    }

    function ejecutarBloque(block) {
        // Simulaci√≥n de comandos (solo algunos ejemplos)
        addLog(`Ejecutando: ${block.name} con par√°metros ${block.params.join(', ')}`);
        switch (block.name) {
            case 'mover_x':
                let objX = gameObjects[block.params[0]];
                if (objX) objX.x += Number(block.params[1]);
                break;
            case 'mover_y':
                let objY = gameObjects[block.params[0]];
                if (objY) objY.y += Number(block.params[1]);
                break;
            case 'ir_a':
                let objA = gameObjects[block.params[0]];
                if (objA) {
                    objA.x = Number(block.params[1]);
                    objA.y = Number(block.params[2]);
                }
                break;
            case 'cambiar_color':
                let objC = gameObjects[block.params[0]];
                if (objC) {
                    let col = block.params[1];
                    if (col === 'rojo') objC.color = '#e74c3c';
                    else if (col === 'azul') objC.color = '#3498db';
                    else if (col === 'verde') objC.color = '#2ecc71';
                    else if (col === 'amarillo') objC.color = '#f1c40f';
                }
                break;
            case 'decir':
                addLog(`üó£Ô∏è ${block.params[0]}`);
                break;
            case 'esperar':
                // Simulamos espera con un mensaje
                addLog(`‚è±Ô∏è Esperando ${block.params[0]} segundos`);
                break;
            default:
                // Otros comandos se ignoran por simplicidad
                break;
        }
        drawGame();
    }

    function ejecutarTodo() {
        addLog('--- INICIO EJECUCI√ìN ---');
        for (let block of scriptBlocks) {
            ejecutarBloque(block);
        }
        addLog('--- FIN EJECUCI√ìN ---');
    }

    function resetGame() {
        gameObjects = {
            gato: { name: 'gato', x: 100, y: 150, color: '#f1c40f', visible: true, tama√±o: 100 },
            enemigo: { name: 'enemigo', x: 300, y: 150, color: '#e74c3c', visible: true, tama√±o: 100 }
        };
        variables = { puntaje: 0 };
        drawGame();
        addLog('Juego reiniciado');
    }

    // ============================================================
    // INICIALIZACI√ìN
    // ============================================================
    window.onload = () => {
        renderPalette();
        drawGame();
        document.getElementById('runBtn').addEventListener('click', ejecutarTodo);
        document.getElementById('resetBtn').addEventListener('click', resetGame);
        document.getElementById('clearBtn').addEventListener('click', () => {
            scriptBlocks = [];
            renderScript();
            addLog('Script limpiado');
        });
    };

    // Exponer funciones globales
    window.showCategory = showCategory;
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2008 Shape Programmer</title>
    <style>
        /* === ESTÃ‰TICA 2008: VIBE WEB 2.0 + TOQUES VINTAGE === */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #39658a; /* fondo azul degradado antiguo */
            background: -moz-linear-gradient(top, #4b7ca1, #1a4b6d);
            background: -webkit-gradient(linear, left top, left bottom, from(#4b7ca1), to(#1a4b6d));
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Monaco', cursive, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            margin: 0;
            border: 3px solid #ffcc00; /* borde amarillento nostÃ¡lgico */
            box-shadow: inset 0 0 30px #00000066;
        }

        .ventana-principal {
            width: 1100px;
            max-width: 100%;
            background: #ece9d8; /* beige claro de Windows XP */
            border: 4px solid #2a6f9c;
            border-radius: 12px 12px 8px 8px;
            padding: 12px;
            -webkit-box-shadow: 8px 8px 16px #1e1e1e, inset 2px 2px 4px #ffffffb0;
            box-shadow: 8px 8px 16px #1e1e1e, inset 2px 2px 4px #ffffffb0;
            backdrop-filter: blur(1px);
        }

        /* barra de tÃ­tulo estilo XP */
        .titulo-ventana {
            background: #2a6f9c;
            padding: 6px 10px;
            border-radius: 8px 8px 0 0;
            color: white;
            font-weight: bold;
            font-size: 20px;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 #0f2f44;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #ffd966;
        }

        .titulo-ventana img {
            width: 32px;
            height: 32px;
            filter: drop-shadow(2px 2px 0 #0b1b28);
        }

        .contenido-flex {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        /* panel de comandos (izquierda) */
        .panel-codigo {
            flex: 1.2;
            min-width: 280px;
            background: #d4d0c8; /* gris clarito retro */
            border: 3px inset #ffffffd0;
            border-right-color: #808080;
            border-bottom-color: #808080;
            padding: 15px;
            box-shadow: inset -2px -2px 8px #404040, inset 2px 2px 8px #f0f0f0;
        }

        .panel-codigo label {
            display: block;
            font-size: 18px;
            color: #1e3a5f;
            margin-bottom: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 0 #bbccdd;
        }

        textarea {
            width: 100%;
            height: 200px;
            background: #171717;
            border: 4px solid #7b7b7b;
            color: #00ff00; /* verde fosforito de monitor antiguo */
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            padding: 10px;
            resize: vertical;
            box-shadow: inset 0 0 12px #00aa00, 0 0 5px cyan;
            border-radius: 0;
            line-height: 1.5;
        }

        .botonera {
            margin: 15px 0 5px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .boton-2008 {
            background: #b0d0f0;
            border: 3px outset #ffffff;
            border-right-color: #2a3f6e;
            border-bottom-color: #2a3f6e;
            color: #002856;
            font-family: 'Comic Sans MS', cursive;
            font-weight: bold;
            font-size: 18px;
            padding: 8px 25px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 2px 2px 0 #0a1c33;
            transition: 0.1s ease;
            border-radius: 0px;
        }

        .boton-2008:hover {
            background: #c5e1ff;
            border: 3px outset #fcfcfc;
            transform: scale(0.98);
        }

        .boton-2008:active {
            border: 3px inset #8ba0c0;
            background: #8faed0;
            box-shadow: inset 1px 1px 5px #131313;
        }

        /* panel canvas (derecha) */
        .panel-canvas {
            flex: 2;
            min-width: 400px;
            background: #586e7e;
            border: 5px ridge #6f8fa2;
            padding: 10px;
            box-shadow: 0 0 0 2px #2c4b63, 10px 10px 20px #00000070;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            background: #2c3e4e;
            border: 3px solid #b9c9d6;
            box-shadow: inset 0 0 30px #000000, 4px 4px 8px black;
            cursor: crosshair;
            image-rendering: pixelated; /* toque retro */
        }

        .barra-estado {
            margin-top: 15px;
            background: #b7c9d6;
            border: 2px inset #f0f0f0;
            border-top-color: #4a5c6b;
            border-left-color: #4a5c6b;
            padding: 6px 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #002240;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-text {
            text-shadow: 1px 1px 0 #cedae4;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .contador-shapes {
            background: #1d4357;
            color: #c0e0ff;
            padding: 2px 12px;
            border: 2px inset #58a3c7;
            border-radius: 20px;
            font-size: 15px;
        }

        .marquee-2008 {
            background: #f0dd96;
            border: 2px solid #aa7b3c;
            padding: 4px;
            font-size: 18px;
            color: #4d2800;
            margin: 8px 0 0;
            white-space: nowrap;
            overflow: hidden;
        }

        .marquee-2008 span {
            display: inline-block;
            width: 100%;
            animation: marquesina 12s linear infinite;
            font-weight: bold;
        }

        @keyframes marquesina {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        hr {
            border: 1px solid #406b8a;
            border-style: inset;
            margin: 12px 0 4px;
        }
    </style>
</head>
<body>
<div class="ventana-principal">
    <div class="titulo-ventana">
        <span>â—ˆ SHAPE PROGRAMMER 2008 â—ˆ</span>
        <span style="font-size:14px; margin-left:auto;">powered by Comic Sans</span>
    </div>
    <div class="marquee-2008">
        <span>â˜… BIENVENIDO AL ESTUDIO DE PROGRAMACIÃ“N RETRO â˜… CREA TUS FIGURAS CON COMANDOS â˜… MUEVE Y TELETRANSPORTA â˜… ESTÃ‰TICA 2008 â˜…</span>
    </div>

    <div class="contenido-flex">
        <!-- PANEL IZQUIERDO: CÃ“DIGO -->
        <div class="panel-codigo">
            <label>ðŸ“Ÿ INGRESA TUS COMANDOS (una lÃ­nea = un comando):</label>
            <textarea id="codigoArea" placeholder="Ejemplo:
create:&quot;cuadradoRojo,1&quot;:&quot;Cubo&quot;:&quot;red&quot;
mov:&quot;60&quot;:&quot;20&quot;
create:&quot;circuloAzul,2&quot;:&quot;CÃ­rculo&quot;:&quot;#2266ff&quot;
tp:&quot;400&quot;:&quot;200&quot;">create:"MiForma,101":"Cubo":"#FF44AA"
mov:"30":"-10"
create:"Bola,202":"Circulo":"gold"
tp:"500":"150"</textarea>

            <div class="botonera">
                <button class="boton-2008" id="runBtn">â–¶ EJECUTAR</button>
                <button class="boton-2008" id="resetBtn">â™» RESET SHAPES</button>
                <button class="boton-2008" id="limpiarCmdBtn">âŒ§ LIMPIAR CÃ“DIGO</button>
            </div>
            <hr>
            <div style="font-size:14px; color:#142f44; background:#fbe6b0; padding:8px; border:2px dashed #b0804c;">
                <strong>COMANDOS 2008:</strong><br>
                <span style="color:#a52a2a;">create:"nombre,ID":"Cubo/Circulo/Triangulo":"color"</span><br>
                <span style="color:#1e4d6b;">mov:"X":"Y"  (mueve Ãºltima figura)</span><br>
                <span style="color:#1e4d6b;">tp:"X":"Y"   (teletransporta Ãºltima figura)</span><br>
                <span style="font-size:12px;">*Los colores: nombre o hex. *Coordenadas en canvas (px).</span>
            </div>
        </div>

        <!-- PANEL DERECHO: CANVAS -->
        <div class="panel-canvas">
            <canvas id="lienzo" width="700" height="400"></canvas>
            <div class="barra-estado">
                <span class="status-text" id="estadoMsg">âœ” Listo. Crea figuras.</span>
                <span class="contador-shapes" id="contadorShapes">0 shapes</span>
            </div>
            <div style="margin-top: 6px; text-align:right; color:#e9f2fa; text-shadow:1px 1px 0 #0f1f2f;">
                canvas 700x400
            </div>
        </div>
    </div>

    <!-- decoraciÃ³n extra pixel 2008 -->
    <div style="display: flex; gap: 12px; margin-top: 12px; background:#cddae5; padding: 4px; border:1px solid #457d9c;">
        <span>â˜…</span><span> MSN 2008</span><span>â˜…</span><span style="margin-left:auto;">MySpace</span><span>â˜…</span><span>Fotolog</span><span>â˜…</span>
    </div>
</div>

<script>
    (function() {
        // --- CONFIGURACIÃ“N Y ESTADO ---
        const canvas = document.getElementById('lienzo');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('estadoMsg');
        const contadorEl = document.getElementById('contadorShapes');

        // Array de shapes
        let shapes = [];
        // Recordar Ã­ndice de la Ãºltima figura creada (para mov/tp)
        let lastShapeIndex = -1;

        // PosiciÃ³n por defecto (centro del canvas)
        const DEFAULT_X = 350;
        const DEFAULT_Y = 200;

        // --- FUNCIONES DE DIBUJO (estilo bÃ¡sico, centrado) ---
        function drawShape(shape) {
            const { type, color, x, y } = shape;
            ctx.fillStyle = color;
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 2;
            ctx.shadowColor = '#00000080';
            ctx.shadowBlur = 6;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;

            switch (type.toLowerCase()) {
                case 'cubo':
                case 'cube':
                case 'cuadrado':
                    ctx.fillRect(x - 25, y - 25, 50, 50);
                    ctx.strokeRect(x - 25, y - 25, 50, 50);
                    break;
                case 'circulo':
                case 'circle':
                case 'cÃ­rculo':
                    ctx.beginPath();
                    ctx.arc(x, y, 25, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'triangulo':
                case 'triangle':
                    ctx.beginPath();
                    ctx.moveTo(x, y - 30);       // vÃ©rtice superior
                    ctx.lineTo(x - 25, y + 15);   // inferior izquierdo
                    ctx.lineTo(x + 25, y + 15);   // inferior derecho
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    break;
                default:
                    // si no reconoce, dibuja un rombo raro (fallback)
                    ctx.beginPath();
                    ctx.moveTo(x, y - 20);
                    ctx.lineTo(x + 20, y);
                    ctx.lineTo(x, y + 20);
                    ctx.lineTo(x - 20, y);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
            }
            // pequeÃ±os detalles: borde blanco y sombra retro
            ctx.shadowBlur = 0; // reset para no interferir
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // fondo tipo cuadrÃ­cula (estilo programaciÃ³n 2008)
            ctx.fillStyle = '#20394c';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // cuadrÃ­cula sutil
            ctx.strokeStyle = '#4c6c87';
            ctx.lineWidth = 0.5;
            for (let i = 0; i < canvas.width; i += 30) {
                ctx.beginPath();
                ctx.strokeStyle = '#2b4b5e';
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 30) {
                ctx.beginPath();
                ctx.strokeStyle = '#2b4b5e';
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }

            // dibujar cada figura
            shapes.forEach(shape => drawShape(shape));

            // actualizar contador
            contadorEl.innerText = shapes.length + (shapes.length === 1 ? ' shape' : ' shapes');
        }

        // --- PARSE Y EJECUCIÃ“N DE COMANDOS ---
        function ejecutarComando(linea, numeroLinea) {
            linea = linea.trim();
            if (linea === '' || linea.startsWith('//')) return true; // comentario / vacÃ­o

            const partes = linea.split(':').map(s => s.trim());
            if (partes.length < 2) {
                statusEl.innerText = `Error lÃ­nea ${numeroLinea}: formato incorrecto`;
                return false;
            }

            const comando = partes[0].toLowerCase();
            // quitar comillas dobles del principio y final de cada argumento
            const args = partes.slice(1).map(arg => arg.replace(/^"|"$/g, ''));

            try {
                if (comando === 'create') {
                    if (args.length < 3) {
                        statusEl.innerText = `Error create: se necesitan 3 argumentos`;
                        return false;
                    }
                    // args[0] = "nombre,ID"   ,  args[1] = forma,  args[2] = color
                    const nombreId = args[0];
                    let nombre = nombreId;
                    let id = '' + (shapes.length + 1); // id por defecto
                    if (nombreId.includes(',')) {
                        const split = nombreId.split(',').map(s => s.trim());
                        nombre = split[0] || 'sinNombre';
                        id = split[1] || id;
                    } else {
                        nombre = nombreId;
                    }

                    let formaRaw = args[1].toLowerCase();
                    // normalizar a "Cubo", "Circulo", "Triangulo"
                    let forma = 'Cubo';
                    if (formaRaw.includes('circulo') || formaRaw.includes('circle') || formaRaw.includes('cÃ­rculo')) forma = 'Circulo';
                    else if (formaRaw.includes('triangulo') || formaRaw.includes('triangle')) forma = 'Triangulo';
                    else forma = 'Cubo'; // por defecto

                    const color = args[2] || '#FFB6C1'; // rosa pastel por defecto

                    // Crear nueva figura con coordenadas por defecto (centro)
                    const newShape = {
                        id: id,
                        name: nombre,
                        type: forma,
                        color: color,
                        x: DEFAULT_X,
                        y: DEFAULT_Y
                    };
                    shapes.push(newShape);
                    lastShapeIndex = shapes.length - 1;
                    statusEl.innerText = `âœ” Creado: ${nombre} (ID ${id})`;
                }
                else if (comando === 'mov') {
                    if (shapes.length === 0) {
                        statusEl.innerText = `Error mov: no hay shapes`;
                        return false;
                    }
                    if (args.length < 2) {
                        statusEl.innerText = `Error mov: necesito X e Y`;
                        return false;
                    }
                    const dx = parseFloat(args[0]);
                    const dy = parseFloat(args[1]);
                    if (isNaN(dx) || isNaN(dy)) {
                        statusEl.innerText = `Error mov: X e Y deben ser nÃºmeros`;
                        return false;
                    }
                    const shape = shapes[lastShapeIndex];
                    shape.x += dx;
                    shape.y += dy;
                    statusEl.innerText = `âœ” Movido Ãºltimo shape (${shape.name}) a (${Math.round(shape.x)},${Math.round(shape.y)})`;
                }
                else if (comando === 'tp') {
                    if (shapes.length === 0) {
                        statusEl.innerText = `Error tp: no hay shapes`;
                        return false;
                    }
                    if (args.length < 2) {
                        statusEl.innerText = `Error tp: necesito X e Y`;
                        return false;
                    }
                    const newX = parseFloat(args[0]);
                    const newY = parseFloat(args[1]);
                    if (isNaN(newX) || isNaN(newY)) {
                        statusEl.innerText = `Error tp: coordenadas invÃ¡lidas`;
                        return false;
                    }
                    const shape = shapes[lastShapeIndex];
                    shape.x = newX;
                    shape.y = newY;
                    statusEl.innerText = `âœ” Teletransportado Ãºltimo shape a (${newX},${newY})`;
                }
                else {
                    statusEl.innerText = `Comando desconocido: ${comando}`;
                    return false;
                }
            } catch (e) {
                statusEl.innerText = `Error ejecutando lÃ­nea ${numeroLinea}: ${e.message}`;
                return false;
            }
            return true;
        }

        function ejecutarTodo() {
            const codigo = document.getElementById('codigoArea').value;
            const lineas = codigo.split('\n');
            let algunaOk = false;
            for (let i = 0; i < lineas.length; i++) {
                const ok = ejecutarComando(lineas[i], i + 1);
                if (ok) algunaOk = true;
            }
            redrawCanvas();
            if (!algunaOk && shapes.length === 0) {
                statusEl.innerText = 'âš  No se ejecutÃ³ ningÃºn comando vÃ¡lido';
            }
        }

        // --- RESET ---
        function resetShapes() {
            shapes = [];
            lastShapeIndex = -1;
            redrawCanvas();
            statusEl.innerText = 'â™» Shapes eliminadas. Crea nuevas.';
        }

        // --- LIMPIAR TEXTAREA ---
        function limpiarComandos() {
            document.getElementById('codigoArea').value = '';
            statusEl.innerText = 'âŒ¨ Escribe nuevos comandos';
        }

        // --- INICIALIZACIÃ“N Y EVENTOS ---
        window.addEventListener('load', () => {
            redrawCanvas(); // lienzo vacÃ­o
            statusEl.innerText = 'Ready. Escribe comandos y pulsa EJECUTAR.';
        });

        document.getElementById('runBtn').addEventListener('click', () => {
            ejecutarTodo();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            resetShapes();
        });

        document.getElementById('limpiarCmdBtn').addEventListener('click', () => {
            limpiarComandos();
        });

        // Ejemplo extra: si quieres insertar un shape demo con doble click en canvas (guiÃ±o)
        canvas.addEventListener('dblclick', (e) => {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const mouseX = (e.clientX - rect.left) * scaleX;
            const mouseY = (e.clientY - rect.top) * scaleY;
            // agregar circulito gris como atajo (no modifica estado de comandos)
            shapes.push({
                id: 'dblclick',
                name: 'dblclick',
                type: 'Circulo',
                color: '#AAAAAA',
                x: mouseX,
                y: mouseY
            });
            lastShapeIndex = shapes.length - 1;
            redrawCanvas();
            statusEl.innerText = `âž• AÃ±adido cÃ­rculo gris (doble click) en (${Math.round(mouseX)},${Math.round(mouseY)})`;
        });
    })();
</script>
</body>
</html>

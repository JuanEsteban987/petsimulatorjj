<!DOCTYPE html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Scratch - 250+ Bloques y Editor de Sprites</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .game-container {
            width: 1400px;
            max-width: 100%;
            background: #ecf0f1;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .header {
            background: #34495e;
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
        }
        .header button {
            background: #f39c12;
            border: none;
            border-radius: 40px;
            padding: 12px 25px;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 0 #b96f0b;
        }
        .main-area {
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        /* Panel izquierdo: canvas + editor de sprites */
        .canvas-panel {
            flex: 2;
            background: #bdc3c7;
            border-radius: 15px;
            padding: 15px;
            box-shadow: inset 0 0 10px #7f8c8d;
        }
        canvas {
            width: 100%;
            height: 300px;
            background: #2c3e50;
            border-radius: 10px;
            border: 3px solid #34495e;
        }
        .sprite-editor {
            background: #95a5a6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            color: #2c3e50;
            font-weight: bold;
        }
        .sprite-editor h3 {
            margin: 0 0 10px 0;
            color: white;
            text-shadow: 1px 1px 0 #7f8c8d;
        }
        .editor-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        .editor-row label {
            width: 70px;
        }
        .editor-row input, .editor-row select {
            flex: 1;
            padding: 5px;
            border: 2px solid #7f8c8d;
            border-radius: 5px;
        }
        .log {
            background: #2c3e50;
            color: #2ecc71;
            padding: 8px;
            margin-top: 15px;
            border-radius: 5px;
            height: 70px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        /* Panel derecho: bloques */
        .blocks-panel {
            flex: 3;
            background: #bdc3c7;
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .categories {
            display: flex;
            gap: 5px;
            background: #95a5a6;
            padding: 8px;
            border-radius: 10px;
            flex-wrap: wrap;
        }
        .cat-btn {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: 0.1s;
        }
        .cat-btn:hover { transform: scale(1.05); }
        .cat-btn.active { box-shadow: 0 0 0 3px black; }
        .palette {
            background: #95a5a6;
            border-radius: 10px;
            padding: 10px;
            height: 250px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
        }
        .block {
            background: #4a90e2;
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 0 #2a4b7a;
            cursor: grab;
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .block.motion { background: #4a90e2; }
        .block.looks { background: #9b59b6; }
        .block.sound { background: #e67e22; }
        .block.event { background: #f1c40f; color: black; }
        .block.control { background: #e74c3c; }
        .block.sensing { background: #3498db; }
        .block.operators { background: #2ecc71; }
        .block.variables { background: #e67e22; }
        .script-area {
            background: #7f8c8d;
            border-radius: 10px;
            padding: 15px;
            min-height: 250px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 5px;
            box-shadow: inset 0 0 10px #34495e;
        }
        .script-block {
            background: #4a90e2;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            box-shadow: 0 4px 0 #2a4b7a;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            margin-bottom: 2px;
        }
        .script-block .delete {
            background: #c0392b;
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            margin-left: auto;
        }
        .script-block input, .script-block select {
            width: 60px;
            background: white;
            border: none;
            border-radius: 5px;
            padding: 2px 5px;
            color: black;
        }
        .bottom-buttons {
            display: flex;
            gap: 10px;
            padding: 10px;
        }
        .bottom-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            background: #34495e;
            color: white;
            cursor: pointer;
        }
        .bottom-buttons .run {
            background: #27ae60;
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="header">
        <h1>üê± Super Scratch - 250+ Bloques + Editor de Sprites</h1>
        <button id="runBtn">‚ñ∂ EJECUTAR</button>
    </div>
    <div class="main-area">
        <!-- Panel izquierdo: canvas + editor -->
        <div class="canvas-panel">
            <canvas id="gameCanvas" width="500" height="300"></canvas>
            <div class="sprite-editor">
                <h3>‚úèÔ∏è Editor de Sprites</h3>
                <div class="editor-row">
                    <label>Objeto:</label>
                    <select id="spriteSelect">
                        <option value="gato">Gato</option>
                        <option value="enemigo">Enemigo</option>
                    </select>
                </div>
                <div class="editor-row">
                    <label>Pos X:</label>
                    <input type="range" id="posX" min="20" max="480" value="100">
                    <span id="posXVal">100</span>
                </div>
                <div class="editor-row">
                    <label>Pos Y:</label>
                    <input type="range" id="posY" min="20" max="280" value="150">
                    <span id="posYVal">150</span>
                </div>
                <div class="editor-row">
                    <label>Color:</label>
                    <select id="colorSelect">
                        <option value="#f1c40f">Amarillo</option>
                        <option value="#3498db">Azul</option>
                        <option value="#2ecc71">Verde</option>
                        <option value="#e74c3c">Rojo</option>
                        <option value="#9b59b6">Morado</option>
                    </select>
                </div>
                <div class="editor-row">
                    <label>Tama√±o %:</label>
                    <input type="range" id="size" min="10" max="200" value="100">
                    <span id="sizeVal">100</span>
                </div>
                <div class="editor-row">
                    <label>Visible:</label>
                    <input type="checkbox" id="visible" checked>
                </div>
            </div>
            <div class="log" id="log">> Listo</div>
        </div>

        <!-- Panel derecho: bloques -->
        <div class="blocks-panel">
            <div class="categories" id="categories">
                <!-- Se generan con JS -->
            </div>
            <div class="palette" id="palette"></div>
            <div class="script-area" id="scriptArea"></div>
            <div class="bottom-buttons">
                <button id="resetBtn">‚Ü∫ Reiniciar</button>
                <button id="clearBtn">üóëÔ∏è Limpiar</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ============================================================
    // CONFIGURACI√ìN: M√ÅS DE 250 BLOQUES GENERADOS DIN√ÅMICAMENTE
    // ============================================================

    // Colores por categor√≠a (para los bloques)
    const categoryColors = {
        motion: '#4a90e2',
        looks: '#9b59b6',
        sound: '#e67e22',
        event: '#f1c40f',
        control: '#e74c3c',
        sensing: '#3498db',
        operators: '#2ecc71',
        variables: '#e67e22'
    };

    // Funci√≥n para generar bloques de movimiento (m√°s de 40)
    function generateMotionBlocks() {
        let blocks = [];
        // Direcciones b√°sicas
        const directions = ['arriba', 'abajo', 'izquierda', 'derecha', 'arriba-izquierda', 'arriba-derecha', 'abajo-izquierda', 'abajo-derecha'];
        directions.forEach(dir => {
            blocks.push({ name: `mover_${dir}`, text: `mover ${dir}`, params: ['objeto', 'pasos'], default: ['gato', 10], color: 'motion' });
        });
        // Pasos predefinidos
        [1,5,10,20,50,100].forEach(pasos => {
            blocks.push({ name: `mover_${pasos}`, text: `mover ${pasos} pasos`, params: ['objeto'], default: ['gato'], color: 'motion' });
        });
        // Ir a posiciones espec√≠ficas
        [[0,0], [100,100], [200,150], [300,200], [400,100]].forEach(([x,y]) => {
            blocks.push({ name: `ir_a_${x}_${y}`, text: `ir a (${x},${y})`, params: ['objeto'], default: ['gato'], color: 'motion' });
        });
        // Deslizar con diferentes tiempos
        [0.5,1,2,3].forEach(seg => {
            blocks.push({ name: `deslizar_${seg}s`, text: `deslizar ${seg}s a X`, params: ['objeto', 'destinoX'], default: ['gato', 200], color: 'motion' });
        });
        // Rebote, girar, apuntar
        blocks.push({ name: 'rebotar_si_borde', text: 'rebotar si toca borde', params: ['objeto'], default: ['gato'], color: 'motion' });
        [15,30,45,90,180].forEach(grados => {
            blocks.push({ name: `girar_${grados}`, text: `girar ${grados} grados`, params: ['objeto'], default: ['gato'], color: 'motion' });
        });
        ['rat√≥n', 'centro', 'enemigo'].forEach(dest => {
            blocks.push({ name: `apuntar_hacia_${dest}`, text: `apuntar hacia ${dest}`, params: ['objeto'], default: ['gato'], color: 'motion' });
        });
        return blocks;
    }

    // Apariencia: muchos colores y efectos
    function generateLooksBlocks() {
        let blocks = [];
        const colors = ['rojo', 'azul', 'verde', 'amarillo', 'morado', 'naranja', 'rosa', 'cian', 'blanco', 'negro'];
        colors.forEach(c => {
            blocks.push({ name: `cambiar_color_${c}`, text: `cambiar color a ${c}`, params: ['objeto'], default: ['gato'], color: 'looks' });
        });
        // Tama√±os
        [50,75,100,125,150,200].forEach(sz => {
            blocks.push({ name: `tama√±o_${sz}`, text: `fijar tama√±o ${sz}%`, params: ['objeto'], default: ['gato'], color: 'looks' });
        });
        // Efectos de ghost, pixelar, etc.
        ['desvanecer', 'pixelar', 'brillo'].forEach(ef => {
            [10,25,50,75].forEach(val => {
                blocks.push({ name: `${ef}_${val}`, text: `${ef} ${val}%`, params: ['objeto'], default: ['gato'], color: 'looks' });
            });
        });
        // Mostrar/ocultar
        blocks.push({ name: 'mostrar', text: 'mostrar', params: ['objeto'], default: ['gato'], color: 'looks' });
        blocks.push({ name: 'ocultar', text: 'ocultar', params: ['objeto'], default: ['gato'], color: 'looks' });
        // Decir/pensar
        ['Hola', 'Adi√≥s', '...', '¬°Genial!'].forEach(msg => {
            blocks.push({ name: `decir_${msg}`, text: `decir "${msg}"`, params: [], default: [], color: 'looks' });
        });
        return blocks;
    }

    // Sonido: varios sonidos y efectos
    function generateSoundBlocks() {
        let blocks = [];
        const sounds = ['maullido', 'ladrido', 'explosi√≥n', 'salto', 'moneda', 'laser', 'campana', 'disparo'];
        sounds.forEach(s => {
            blocks.push({ name: `sonido_${s}`, text: `reproducir ${s}`, params: [], default: [], color: 'sound' });
        });
        // Vol√∫menes
        [10,20,50,100].forEach(v => {
            blocks.push({ name: `volumen_${v}`, text: `fijar volumen ${v}%`, params: [], default: [], color: 'sound' });
        });
        // Tambores
        [1,2,3,4,5].forEach(t => {
            blocks.push({ name: `tambor_${t}`, text: `tocar tambor ${t}`, params: [], default: [], color: 'sound' });
        });
        return blocks;
    }

    // Eventos: muchas teclas y mensajes
    function generateEventBlocks() {
        let blocks = [];
        // Teclas A-Z
        'abcdefghijklmnopqrstuvwxyz'.split('').forEach(letter => {
            blocks.push({ name: `tecla_${letter}`, text: `al presionar tecla ${letter.toUpperCase()}`, params: [], default: [], color: 'event' });
        });
        // Mensajes personalizados
        ['inicio', 'saludo', 'pelea', 'victoria', 'derrota', 'nivel'].forEach(msg => {
            blocks.push({ name: `evento_${msg}`, text: `al recibir ${msg}`, params: [], default: [], color: 'event' });
            blocks.push({ name: `enviar_${msg}`, text: `enviar ${msg}`, params: [], default: [], color: 'event' });
        });
        return blocks;
    }

    // Control: muchas repeticiones y condiciones
    function generateControlBlocks() {
        let blocks = [];
        [1,2,3,4,5,10,20,50,100].forEach(n => {
            blocks.push({ name: `repetir_${n}`, text: `repetir ${n} veces`, params: [], default: [], color: 'control' });
        });
        // Si condicional con diferentes operadores (simulado)
        ['vida > 50', 'vida < 20', 'tocando enemigo'].forEach(cond => {
            blocks.push({ name: `si_${cond.replace(/ /g,'_')}`, text: `si ${cond} entonces`, params: [], default: [], color: 'control' });
        });
        // Esperar
        [0.5,1,2,3,5].forEach(t => {
            blocks.push({ name: `esperar_${t}s`, text: `esperar ${t} segundos`, params: [], default: [], color: 'control' });
        });
        // Por siempre, detener
        blocks.push({ name: 'por_siempre', text: 'por siempre', params: [], default: [], color: 'control' });
        blocks.push({ name: 'detener', text: 'detener programa', params: [], default: [], color: 'control' });
        return blocks;
    }

    // Sensores: muchas detecciones
    function generateSensingBlocks() {
        let blocks = [];
        // Tocando objeto
        ['gato', 'enemigo', 'rat√≥n', 'borde'].forEach(obj => {
            blocks.push({ name: `tocando_${obj}`, text: `¬øtocando ${obj}?`, params: ['objeto'], default: ['gato'], color: 'sensing' });
        });
        // Distancia a
        ['gato', 'enemigo', 'rat√≥n'].forEach(dest => {
            blocks.push({ name: `distancia_a_${dest}`, text: `distancia a ${dest}`, params: ['objeto'], default: ['gato'], color: 'sensing' });
        });
        // Preguntas
        ['¬øNombre?', '¬øEdad?', '¬øColor favorito?'].forEach(p => {
            blocks.push({ name: `preguntar_${p}`, text: `preguntar "${p}"`, params: [], default: [], color: 'sensing' });
        });
        // Posici√≥n X/Y de objetos
        ['gato', 'enemigo'].forEach(obj => {
            blocks.push({ name: `posX_${obj}`, text: `posici√≥n X de ${obj}`, params: [], default: [], color: 'sensing' });
            blocks.push({ name: `posY_${obj}`, text: `posici√≥n Y de ${obj}`, params: [], default: [], color: 'sensing' });
        });
        return blocks;
    }

    // Operadores: muchas operaciones num√©ricas y l√≥gicas
    function generateOperatorsBlocks() {
        let blocks = [];
        // Suma, resta, multiplica, divide con n√∫meros
        for (let a = 1; a <= 5; a++) {
            for (let b = 1; b <= 5; b++) {
                blocks.push({ name: `suma_${a}_${b}`, text: `${a} + ${b}`, params: [], default: [], color: 'operators' });
                blocks.push({ name: `resta_${a}_${b}`, text: `${a} - ${b}`, params: [], default: [], color: 'operators' });
                blocks.push({ name: `multiplica_${a}_${b}`, text: `${a} * ${b}`, params: [], default: [], color: 'operators' });
                if (b !== 0) blocks.push({ name: `divide_${a}_${b}`, text: `${a} / ${b}`, params: [], default: [], color: 'operators' });
            }
        }
        // Aleatorio rangos
        [[1,10], [1,100], [50,100], [0,1]].forEach(([min,max]) => {
            blocks.push({ name: `aleatorio_${min}_${max}`, text: `aleatorio ${min} a ${max}`, params: [], default: [], color: 'operators' });
        });
        // Comparaciones
        ['>', '<', '=', '‚â•', '‚â§'].forEach(op => {
            blocks.push({ name: `comparar_${op}`, text: `${op}`, params: ['a','b'], default: [5,3], color: 'operators' });
        });
        // L√≥gicos
        ['y', 'o', 'no'].forEach(op => {
            blocks.push({ name: `logico_${op}`, text: `${op}`, params: [], default: [], color: 'operators' });
        });
        return blocks;
    }

    // Variables: muchas variables predefinidas
    function generateVariablesBlocks() {
        let blocks = [];
        const varNames = ['puntaje', 'vida', 'energ√≠a', 'tiempo', 'nivel', 'monedas'];
        varNames.forEach(v => {
            blocks.push({ name: `crear_${v}`, text: `crear variable ${v}`, params: [], default: [], color: 'variables' });
            blocks.push({ name: `cambiar_${v}_1`, text: `cambiar ${v} por 1`, params: [], default: [], color: 'variables' });
            blocks.push({ name: `fijar_${v}_0`, text: `fijar ${v} a 0`, params: [], default: [], color: 'variables' });
            [5,10,20,50,100].forEach(val => {
                blocks.push({ name: `fijar_${v}_${val}`, text: `fijar ${v} a ${val}`, params: [], default: [], color: 'variables' });
            });
        });
        return blocks;
    }

    // Unir todos los bloques (total > 250)
    const allBlocks = [
        ...generateMotionBlocks(),
        ...generateLooksBlocks(),
        ...generateSoundBlocks(),
        ...generateEventBlocks(),
        ...generateControlBlocks(),
        ...generateSensingBlocks(),
        ...generateOperatorsBlocks(),
        ...generateVariablesBlocks()
    ];
    console.log('Total bloques generados:', allBlocks.length);

    // Agrupar por categor√≠a para la paleta
    const blocksByCategory = {
        motion: allBlocks.filter(b => b.color === 'motion'),
        looks: allBlocks.filter(b => b.color === 'looks'),
        sound: allBlocks.filter(b => b.color === 'sound'),
        event: allBlocks.filter(b => b.color === 'event'),
        control: allBlocks.filter(b => b.color === 'control'),
        sensing: allBlocks.filter(b => b.color === 'sensing'),
        operators: allBlocks.filter(b => b.color === 'operators'),
        variables: allBlocks.filter(b => b.color === 'variables')
    };

    // ============================================================
    // ESTADO DEL JUEGO
    // ============================================================
    let gameObjects = {
        gato: { name: 'gato', x: 100, y: 150, color: '#f1c40f', visible: true, size: 100 },
        enemigo: { name: 'enemigo', x: 300, y: 150, color: '#e74c3c', visible: true, size: 100 }
    };
    let variables = { puntaje: 0, vida: 100, energ√≠a: 50, tiempo: 60, nivel: 1, monedas: 0 };
    let scriptBlocks = [];

    // ============================================================
    // FUNCIONES DE INTERFAZ
    // ============================================================
    let currentCategory = 'motion';

    function showCategory(cat) {
        currentCategory = cat;
        document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        renderPalette();
    }

    function renderPalette() {
        const palette = document.getElementById('palette');
        const blocks = blocksByCategory[currentCategory] || [];
        palette.innerHTML = '';
        blocks.forEach(block => {
            const div = document.createElement('div');
            div.className = `block ${block.color}`;
            div.setAttribute('draggable', 'true');
            div.textContent = block.text;
            div.dataset.name = block.name;
            div.dataset.params = JSON.stringify(block.params || []);
            div.dataset.default = JSON.stringify(block.default || []);
            div.addEventListener('dragstart', handleDragStart);
            palette.appendChild(div);
        });
    }

    function handleDragStart(e) {
        e.dataTransfer.setData('text/plain', JSON.stringify({
            name: e.target.dataset.name,
            params: JSON.parse(e.target.dataset.params),
            default: JSON.parse(e.target.dataset.default)
        }));
        e.dataTransfer.effectAllowed = 'copy';
    }

    const scriptArea = document.getElementById('scriptArea');
    scriptArea.addEventListener('dragover', e => e.preventDefault());
    scriptArea.addEventListener('drop', e => {
        e.preventDefault();
        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        addBlockToScript(data);
    });

    function addBlockToScript(blockData) {
        const newBlock = {
            name: blockData.name,
            params: blockData.default.slice(),
            paramNames: blockData.params
        };
        scriptBlocks.push(newBlock);
        renderScript();
    }

    function renderScript() {
        scriptArea.innerHTML = '';
        scriptBlocks.forEach((block, index) => {
            const blockDiv = document.createElement('div');
            blockDiv.className = 'script-block';
            // Color seg√∫n categor√≠a (buscamos en allBlocks)
            const original = allBlocks.find(b => b.name === block.name) || { color: 'motion' };
            blockDiv.style.backgroundColor = categoryColors[original.color] || '#4a90e2';

            // Texto amigable (usamos el texto guardado)
            const textSpan = document.createElement('span');
            const originalBlock = allBlocks.find(b => b.name === block.name);
            textSpan.textContent = (originalBlock ? originalBlock.text : block.name) + ' ';
            blockDiv.appendChild(textSpan);

            // Par√°metros editables
            if (block.paramNames) {
                block.paramNames.forEach((paramName, i) => {
                    if (paramName === 'objeto') {
                        const select = document.createElement('select');
                        select.innerHTML = `<option>gato</option><option>enemigo</option>`;
                        select.value = block.params[i];
                        select.onchange = (e) => { block.params[i] = e.target.value; };
                        blockDiv.appendChild(select);
                    } else {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = block.params[i];
                        input.style.width = '50px';
                        input.onchange = (e) => { block.params[i] = e.target.value; };
                        blockDiv.appendChild(input);
                    }
                    if (i < block.paramNames.length - 1) blockDiv.appendChild(document.createTextNode(' '));
                });
            }

            const del = document.createElement('span');
            del.className = 'delete';
            del.textContent = '‚úñ';
            del.onclick = () => { scriptBlocks.splice(index, 1); renderScript(); };
            blockDiv.appendChild(del);

            scriptArea.appendChild(blockDiv);
        });
    }

    // ============================================================
    // EDITOR DE SPRITES
    // ============================================================
    const spriteSelect = document.getElementById('spriteSelect');
    const posX = document.getElementById('posX');
    const posY = document.getElementById('posY');
    const posXVal = document.getElementById('posXVal');
    const posYVal = document.getElementById('posYVal');
    const colorSelect = document.getElementById('colorSelect');
    const sizeSlider = document.getElementById('size');
    const sizeVal = document.getElementById('sizeVal');
    const visibleCheck = document.getElementById('visible');

    function updateSpriteEditor() {
        const objName = spriteSelect.value;
        const obj = gameObjects[objName];
        if (!obj) return;
        posX.value = obj.x;
        posY.value = obj.y;
        posXVal.textContent = obj.x;
        posYVal.textContent = obj.y;
        // Aproximar color en select
        if (obj.color === '#f1c40f') colorSelect.value = '#f1c40f';
        else if (obj.color === '#3498db') colorSelect.value = '#3498db';
        else if (obj.color === '#2ecc71') colorSelect.value = '#2ecc71';
        else if (obj.color === '#e74c3c') colorSelect.value = '#e74c3c';
        else if (obj.color === '#9b59b6') colorSelect.value = '#9b59b6';
        sizeSlider.value = obj.size;
        sizeVal.textContent = obj.size;
        visibleCheck.checked = obj.visible;
    }

    spriteSelect.addEventListener('change', updateSpriteEditor);
    posX.addEventListener('input', () => {
        posXVal.textContent = posX.value;
        gameObjects[spriteSelect.value].x = parseInt(posX.value);
        drawGame();
    });
    posY.addEventListener('input', () => {
        posYVal.textContent = posY.value;
        gameObjects[spriteSelect.value].y = parseInt(posY.value);
        drawGame();
    });
    colorSelect.addEventListener('change', () => {
        gameObjects[spriteSelect.value].color = colorSelect.value;
        drawGame();
    });
    sizeSlider.addEventListener('input', () => {
        sizeVal.textContent = sizeSlider.value;
        gameObjects[spriteSelect.value].size = parseInt(sizeSlider.value);
        drawGame();
    });
    visibleCheck.addEventListener('change', () => {
        gameObjects[spriteSelect.value].visible = visibleCheck.checked;
        drawGame();
    });

    // ============================================================
    // DIBUJO Y EJECUCI√ìN
    // ============================================================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const logDiv = document.getElementById('log');

    function addLog(msg) {
        logDiv.innerHTML += '<br>> ' + msg;
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    function drawGame() {
        ctx.fillStyle = '#2c3e50';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (let name in gameObjects) {
            let obj = gameObjects[name];
            if (!obj.visible) continue;
            ctx.save();
            ctx.translate(obj.x, obj.y);
            ctx.fillStyle = obj.color;
            ctx.beginPath();
            ctx.arc(0, 0, 15 * (obj.size/100), 0, 2*Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.restore();
            ctx.fillStyle = '#fff';
            ctx.font = '12px monospace';
            ctx.fillText(name, obj.x-20, obj.y-20);
        }
    }

    function ejecutarBloque(block) {
        addLog(`Ejecutando: ${block.name} (${block.params.join(', ')})`);
        // Implementaci√≥n simplificada de algunos comandos
        const cmd = block.name;
        // Movimiento
        if (cmd.startsWith('mover_')) {
            let obj = gameObjects[block.params[0]] || gameObjects['gato'];
            if (!obj) return;
            let pasos = block.params[1] ? Number(block.params[1]) : 10;
            if (cmd.includes('derecha')) obj.x += pasos;
            else if (cmd.includes('izquierda')) obj.x -= pasos;
            else if (cmd.includes('abajo')) obj.y += pasos;
            else if (cmd.includes('arriba')) obj.y -= pasos;
            else if (cmd.includes('arriba-izquierda')) { obj.x -= pasos; obj.y -= pasos; }
            else if (cmd.includes('arriba-derecha')) { obj.x += pasos; obj.y -= pasos; }
            else if (cmd.includes('abajo-izquierda')) { obj.x -= pasos; obj.y += pasos; }
            else if (cmd.includes('abajo-derecha')) { obj.x += pasos; obj.y += pasos; }
            else { // mover_X pasos
                obj.x += pasos;
            }
        }
        else if (cmd.startsWith('ir_a_')) {
            let partes = cmd.split('_');
            if (partes.length >= 4) {
                let x = parseInt(partes[2]), y = parseInt(partes[3]);
                let obj = gameObjects[block.params[0]] || gameObjects['gato'];
                if (obj) { obj.x = x; obj.y = y; }
            }
        }
        else if (cmd.startsWith('girar_')) {
            // no implementado visualmente, solo log
        }
        else if (cmd.startsWith('cambiar_color_')) {
            let color = cmd.split('_')[2];
            let obj = gameObjects[block.params[0]] || gameObjects['gato'];
            if (obj) {
                if (color === 'rojo') obj.color = '#e74c3c';
                else if (color === 'azul') obj.color = '#3498db';
                else if (color === 'verde') obj.color = '#2ecc71';
                else if (color === 'amarillo') obj.color = '#f1c40f';
                else if (color === 'morado') obj.color = '#9b59b6';
            }
        }
        else if (cmd.startsWith('tama√±o_')) {
            let sz = parseInt(cmd.split('_')[1]);
            let obj = gameObjects[block.params[0]] || gameObjects['gato'];
            if (obj) obj.size = sz;
        }
        else if (cmd === 'mostrar') {
            let obj = gameObjects[block.params[0]] || gameObjects['gato'];
            if (obj) obj.visible = true;
        }
        else if (cmd === 'ocultar') {
            let obj = gameObjects[block.params[0]] || gameObjects['gato'];
            if (obj) obj.visible = false;
        }
        else if (cmd.startsWith('decir_')) {
            addLog(`üó£Ô∏è ${cmd.split('_')[1]}`);
        }
        else if (cmd.startsWith('sonido_')) {
            addLog(`üîä Sonido: ${cmd.split('_')[1]}`);
        }
        else if (cmd.startsWith('esperar_')) {
            addLog(`‚è±Ô∏è Esperando...`);
        }
        else if (cmd.startsWith('fijar_')) {
            // variables
            let partes = cmd.split('_');
            if (partes[1] === 'vida' && partes[2]) {
                variables.vida = parseInt(partes[2]);
            }
        }
        else if (cmd.startsWith('cambiar_')) {
            // variables
        }
        drawGame();
        updateSpriteEditor(); // actualizar sliders si el objeto cambi√≥
    }

    function ejecutarTodo() {
        addLog('--- INICIO EJECUCI√ìN ---');
        for (let block of scriptBlocks) {
            ejecutarBloque(block);
        }
        addLog('--- FIN EJECUCI√ìN ---');
    }

    function resetGame() {
        gameObjects = {
            gato: { name: 'gato', x: 100, y: 150, color: '#f1c40f', visible: true, size: 100 },
            enemigo: { name: 'enemigo', x: 300, y: 150, color: '#e74c3c', visible: true, size: 100 }
        };
        variables = { puntaje: 0, vida: 100, energ√≠a: 50, tiempo: 60, nivel: 1, monedas: 0 };
        drawGame();
        updateSpriteEditor();
        addLog('Juego reiniciado');
    }

    // ============================================================
    // INICIALIZACI√ìN
    // ============================================================
    window.onload = () => {
        // Crear botones de categor√≠as
        const cats = document.getElementById('categories');
        const catList = [
            { id: 'motion', name: 'Movimiento', color: '#4a90e2' },
            { id: 'looks', name: 'Apariencia', color: '#9b59b6' },
            { id: 'sound', name: 'Sonido', color: '#e67e22' },
            { id: 'event', name: 'Eventos', color: '#f1c40f' },
            { id: 'control', name: 'Control', color: '#e74c3c' },
            { id: 'sensing', name: 'Sensores', color: '#3498db' },
            { id: 'operators', name: 'Operadores', color: '#2ecc71' },
            { id: 'variables', name: 'Variables', color: '#e67e22' }
        ];
        catList.forEach(cat => {
            const btn = document.createElement('button');
            btn.className = 'cat-btn';
            btn.style.backgroundColor = cat.color;
            btn.textContent = cat.name;
            btn.onclick = () => showCategory(cat.id);
            cats.appendChild(btn);
        });
        // Activar primera categor√≠a
        document.querySelector('.cat-btn').classList.add('active');
        renderPalette();
        drawGame();
        updateSpriteEditor();

        document.getElementById('runBtn').addEventListener('click', ejecutarTodo);
        document.getElementById('resetBtn').addEventListener('click', resetGame);
        document.getElementById('clearBtn').addEventListener('click', () => {
            scriptBlocks = [];
            renderScript();
            addLog('Script limpiado');
        });
    };
</script>
</body>
</html>
